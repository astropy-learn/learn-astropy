
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>FITS cubes</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=720ed60b" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-ZBXC3EFGGJ"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-ZBXC3EFGGJ');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-ZBXC3EFGGJ');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'FITS-cubes';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="#">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.svg" class="logo__image only-light" alt="None - Home"/>
    <script>document.write(`<img src="_static/logo.svg" class="logo__image only-dark" alt="None - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1 current active">
                <a class="reference internal" href="#">
                    Working with FITS-cubes
                </a>
            </li>
        </ul>
        
    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/astropy-learn/tutorial--FITS-cubes" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/astropy-learn/tutorial--FITS-cubes/issues/new?title=Issue%20on%20page%20%2FFITS-cubes.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Working with FITS-cubes</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="working-with-fits-cubes">
<h1>Working with FITS-cubes<a class="headerlink" href="#working-with-fits-cubes" title="Link to this heading">#</a></h1>
<section id="authors">
<h2>Authors<a class="headerlink" href="#authors" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://www.astronomy.dk">Dhanesh Krishnarao (DK)</a>, <a class="reference external" href="http://www.astro.wisc.edu/our-people/post-doctoral-students/shetty-shravan/">Shravan Shetty</a>, <a class="reference external" href="http://www.astro.wisc.edu/our-people/graduate-students/gonzalez-casanova-diego/">Diego Gonzalez-Casanova</a>, <a class="reference external" href="http://www.astro.wisc.edu/our-people/scientists/hernandez-audra/">Audra Hernandez</a>, Kris Stern, Kelle Cruz, Stephanie Douglas</p>
</section>
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Find and download data using <code class="docutils literal notranslate"><span class="pre">astroquery</span></code></p></li>
<li><p>Read and plot slices across different dimensions of a data cube</p></li>
<li><p>Compare different data sets (2D and 3D) by overploting contours</p></li>
<li><p>Transform coordinate projections and match data resolutions with <code class="docutils literal notranslate"><span class="pre">reproject</span></code></p></li>
<li><p>Create intensity moment maps / velocity maps with <code class="docutils literal notranslate"><span class="pre">spectral_cube</span></code></p></li>
</ul>
</section>
<section id="keywords">
<h2>Keywords<a class="headerlink" href="#keywords" title="Link to this heading">#</a></h2>
<p>FITS, image manipulation, data cubes, radio astronomy, WCS, astroquery, reproject, spectral cube, matplotlib, contour plots, colorbar</p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>In this tutorial we will visualize 2D and 3D data sets in Galactic and equatorial coordinates.</p>
<p>The tutorial will walk you though a visual analysis of the Small Magellanic Cloud (SMC) using HI 21cm emission and a Herschel 250 micron map. We will learn how to read in data from a file, query and download matching data from Herschel using astroquery, and plot the resulting images in a multitude of ways.</p>
<p>The primary libraries we’ll be using are: <a class="reference external" href="http://www.astropy.org/astroquery/">astroquery</a>, <a class="reference external" href="https://spectral-cube.readthedocs.io/en/latest/">spectral_cube</a>, <a class="reference external" href="https://reproject.readthedocs.io/en/stable/#">reproject</a>, <a class="reference external" href="https://matplotlib.org/">matplotlib</a>)</p>
<p>They can be installed using conda:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">astroquery</span>
<span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">spectral</span><span class="o">-</span><span class="n">cube</span>
<span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">reproject</span>
</pre></div>
</div>
<p>Alternatively, if you don’t use conda, you can use pip.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogNorm</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">astropy.units</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">u</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.utils.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">download_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">fits</span>  <span class="c1"># We use fits to open the actual data file</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">spectral_cube</span><span class="w"> </span><span class="kn">import</span> <span class="n">SpectralCube</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.esasky</span><span class="w"> </span><span class="kn">import</span> <span class="n">ESASky</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">TableList</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.wcs</span><span class="w"> </span><span class="kn">import</span> <span class="n">WCS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reproject</span><span class="w"> </span><span class="kn">import</span> <span class="n">reproject_interp</span>

<span class="n">data</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">remote_timeout</span> <span class="o">=</span> <span class="mi">60</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.12.10/x64/lib/python3.12/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
</pre></div>
</div>
</div>
</div>
</section>
<section id="download-the-hi-data">
<h2>Download the HI Data<a class="headerlink" href="#download-the-hi-data" title="Link to this heading">#</a></h2>
<p>We’ll be using HI 21 cm emission data from the <a class="reference external" href="http://adsabs.harvard.edu/cgi-bin/bib_query?arXiv:1610.06175">HI4Pi survey</a>.  We want to look at neutral gas emission from the Magellanic Clouds and learn about the kinematics of the system and column densities. Using the VizieR catalog, we’ve found a relevant data cube to use that covers this region of the sky. You can also download an allsky data cube, but this is a very large file, so picking out sub-sections can be useful!</p>
<p>For us, the <a class="reference external" href="http://cdsarc.u-strasbg.fr/vizier/ftp/cats/J/A+A/594/A116/CUBES/GAL/TAN/TAN_C14.fits">relevant file is available via ftp from CDS Strasbourg</a>.
We have a reduced version of it which will be a FITS data cube in Galactic coordinates using the tangential sky projection.</p>
<p>Sure, we could download this file directly, but why do that when we can load it up via one line of code and have it ready to use in our cache?</p>
</section>
<section id="download-the-hi-fits-cube">
<h2>Download the HI Fits Cube<a class="headerlink" href="#download-the-hi-fits-cube" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Downloads the HI data in a fits file format</span>
<span class="n">hi_datafile</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span>
    <span class="s2">&quot;http://data.astropy.org/tutorials/FITS-cubes/reduced_TAN_C14.fits&quot;</span><span class="p">,</span>
    <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Awesome, so now we have a copy of the data file (a FITS file).  So how do we do anything with it?</p>
<p>Luckily for us, the <a class="reference external" href="https://spectral-cube.readthedocs.io/en/latest/">spectral_cube</a> package does a lot of the nitty gritty work for us to manipulate this data and even quickly look through it.
So let’s open up our data file and read in the data as a SpectralCube!</p>
<p>The variable <code class="docutils literal notranslate"><span class="pre">cube</span></code> has the data using SpectralCube and <code class="docutils literal notranslate"><span class="pre">hi_data</span></code> is the data cube from the FITS file without the special formating from SpectralCube.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hi_data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">hi_datafile</span><span class="p">)</span>  <span class="c1"># Open the FITS file for reading</span>
<span class="n">cube</span> <span class="o">=</span> <span class="n">SpectralCube</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">hi_data</span><span class="p">)</span>  <span class="c1"># Initiate a SpectralCube</span>
<span class="n">hi_data</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Close the FITS file - we already read it in and don&#39;t need it anymore!</span>
</pre></div>
</div>
</div>
</div>
<div class="alert alert-info">
If you happen to already have the FITS file on your system, you can also skip the fits.open step and just directly read a FITS file with SpectralCube like this:
<p><code class="docutils literal notranslate"><span class="pre">#cube</span> <span class="pre">=</span> <span class="pre">SpectralCube.read('path_to_data_file/TAN_C14.fits')</span> </code></p>
</div>
<p>So what does this SpectralCube object actually look like? Let’s find out!  The first check is to print out the cube.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SpectralCube with shape=(450, 150, 150) and unit=K:
 n_x:    150  type_x: GLON-TAN  unit_x: deg    range:   286.727203 deg:  320.797623 deg
 n_y:    150  type_y: GLAT-TAN  unit_y: deg    range:   -50.336450 deg:  -28.401234 deg
 n_s:    450  type_s: VRAD      unit_s: m / s  range:  -598824.534 m / s:  600409.133 m / s
</pre></div>
</div>
</div>
</div>
<section id="some-things-to-pay-attention-to-here">
<h3>Some things to pay attention to here:<a class="headerlink" href="#some-things-to-pay-attention-to-here" title="Link to this heading">#</a></h3>
<p>A data cube has three axes. In this case, there is Galactic Longitude (x), Galactic Latitude (y), and a spectral axis in terms of a LSR Velocity (z - listed as s with <code class="docutils literal notranslate"><span class="pre">spectral_cube</span></code>).</p>
<p>The data hidden in the cube lives as an ndarray with shape (n_s, n_y, n_x) so that axis 0 corresponds with the Spectral Axis, axis 1 corresponds with the Galactic Latitude Axis, and axis 2 corresponds with the Galactic Longitude Axis.</p>
<p>When we <code class="docutils literal notranslate"><span class="pre">print(cube)</span></code> we can see the shape, size, and units of all axes as well as the data stored in the cube. With this cube, the units of the data in the cube are temperatures (K). The spatial axes are in degrees and the Spectral Axis is in (meters / second).</p>
<p>The cube also contains information about the coordinates corresponding to the data in the form of a WCS (World Coordinate System) object.</p>
<p>SpectralCube is clever and keeps all the data masked until you really need it so that you can work with large sets of data. So let’s see what our data actually looks like!</p>
<p>SpectralCube has a <code class="docutils literal notranslate"><span class="pre">quicklook()</span></code> method which can give a handy sneak-peek preview of the data.  It’s useful when you just need to glance at a slice or spectrum without knowing any other information (say, to make sure the data isn’t corrupted or is looking at the right region.)</p>
<p>To do this, we index our cube along one axis (for a slice) or two axes (for a spectrum):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cube</span><span class="p">[</span>
    <span class="mi">300</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:</span>
<span class="p">]</span><span class="o">.</span><span class="n">quicklook</span><span class="p">()</span>  <span class="c1"># Slice the cube along the spectral axis, and display a quick image</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9975fe7596148d50097c14981a812a829aedb2254de77f112d76982489f11327.png" src="_images/9975fe7596148d50097c14981a812a829aedb2254de77f112d76982489f11327.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cube</span><span class="p">[:,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">75</span><span class="p">]</span><span class="o">.</span><span class="n">quicklook</span><span class="p">()</span>  <span class="c1"># Extract a single spectrum through the data cube</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/51c97ca462963e6399451d6411b343a844dc2dd3d68ce38af859c6a1f7fcc456.png" src="_images/51c97ca462963e6399451d6411b343a844dc2dd3d68ce38af859c6a1f7fcc456.png" />
</div>
</div>
<section id="try-messing-around-with-slicing-the-cube-along-different-axes-or-picking-out-different-spectra">
<h4>Try messing around with slicing the cube along different axes, or picking out different spectra<a class="headerlink" href="#try-messing-around-with-slicing-the-cube-along-different-axes-or-picking-out-different-spectra" title="Link to this heading">#</a></h4>
</section>
</section>
</section>
<section id="make-a-smaller-cube-focusing-on-the-magellanic-clouds">
<h2>Make a smaller cube, focusing on the Magellanic Clouds<a class="headerlink" href="#make-a-smaller-cube-focusing-on-the-magellanic-clouds" title="Link to this heading">#</a></h2>
<p>The HI data cube we downloaded is bigger than we actually need it to be.  Let’s try zooming in on just the part we need and make a new <code class="docutils literal notranslate"><span class="pre">sub_cube</span></code>.</p>
<p>The easiest way to do this is to cut out part of the cube with indices or coordinates.</p>
<p>We can extract the world coordinates from the cube using the <code class="docutils literal notranslate"><span class="pre">.world()</span></code> method.</p>
<div class="alert alert-warning">
Warning: using .world() will extract coordinates from every position you ask for. This can be a TON of data if you don't slice through the cube.  One work around is to slice along two axes and extract coordinates just along a single dimension.
</div> 
<p>The output of <code class="docutils literal notranslate"><span class="pre">.world()</span></code> is an Astropy <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> representing the pixel coordinates, which includes units. You can extract these Astropy <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects by slicing the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># extract latitude world coordinates from cube</span>
<span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">lon</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># extract longitude world coordinates from cube</span>
</pre></div>
</div>
</div>
</div>
<p>You can then extract a <code class="docutils literal notranslate"><span class="pre">sub_cube</span></code> in the spatial coordinates of the cube</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define desired latitude and longitude range</span>
<span class="n">lat_range</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">46</span><span class="p">,</span> <span class="o">-</span><span class="mi">40</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>
<span class="n">lon_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">306</span><span class="p">,</span> <span class="mi">295</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>

<span class="c1"># Create a sub_cube cut to these coordinates</span>
<span class="n">sub_cube</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">subcube</span><span class="p">(</span>
    <span class="n">xlo</span><span class="o">=</span><span class="n">lon_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xhi</span><span class="o">=</span><span class="n">lon_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ylo</span><span class="o">=</span><span class="n">lat_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yhi</span><span class="o">=</span><span class="n">lat_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">sub_cube</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SpectralCube with shape=(450, 38, 57) and unit=K:
 n_x:     57  type_x: GLON-TAN  unit_x: deg    range:   294.113498 deg:  306.009028 deg
 n_y:     38  type_y: GLAT-TAN  unit_y: deg    range:   -46.014280 deg:  -40.027398 deg
 n_s:    450  type_s: VRAD      unit_s: m / s  range:  -598824.534 m / s:  600409.133 m / s
</pre></div>
</div>
</div>
</div>
</section>
<section id="cut-along-the-spectral-axis">
<h2>Cut along the Spectral Axis:<a class="headerlink" href="#cut-along-the-spectral-axis" title="Link to this heading">#</a></h2>
<p>We don’t really need data from such a large velocity range so let’s just extract a little slab. We can do this in any units that we want using the <code class="docutils literal notranslate"><span class="pre">.spectral_slab()</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sub_cube_slab</span> <span class="o">=</span> <span class="n">sub_cube</span><span class="o">.</span><span class="n">spectral_slab</span><span class="p">(</span><span class="o">-</span><span class="mf">300.0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="mf">300.0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">sub_cube_slab</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SpectralCube with shape=(226, 38, 57) and unit=K:
 n_x:     57  type_x: GLON-TAN  unit_x: deg    range:   294.113498 deg:  306.009028 deg
 n_y:     38  type_y: GLAT-TAN  unit_y: deg    range:   -46.014280 deg:  -40.027398 deg
 n_s:    226  type_s: VRAD      unit_s: m / s  range:  -299683.842 m / s:  301268.441 m / s
</pre></div>
</div>
</div>
</div>
</section>
<section id="moment-maps">
<h2>Moment Maps<a class="headerlink" href="#moment-maps" title="Link to this heading">#</a></h2>
<p>Moment maps are a useful analysis tool to study data cubes.  In short, a moment is a weighted integral along an axis (typically the Spectral Axis) that can give information about the total Intensity (or column density), mean velocity, or velocity dispersion along lines of sight.</p>
<p>SpectralCube makes this very simple with the <code class="docutils literal notranslate"><span class="pre">.moment()</span></code> method.
We can convert to friendlier spectral units of km/s and these new 2D projections can be saved as new FITS files, complete with modified WCS information as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moment_0</span> <span class="o">=</span> <span class="n">sub_cube_slab</span><span class="o">.</span><span class="n">with_spectral_unit</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">moment</span><span class="p">(</span>
    <span class="n">order</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>  <span class="c1"># Zero-th moment</span>
<span class="n">moment_1</span> <span class="o">=</span> <span class="n">sub_cube_slab</span><span class="o">.</span><span class="n">with_spectral_unit</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">moment</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># First moment</span>

<span class="c1"># Write the moments as a FITS image</span>
<span class="c1"># moment_0.write(&#39;hi_moment_0.fits&#39;)</span>
<span class="c1"># moment_1.write(&#39;hi_moment_1.fits&#39;)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Moment_0 has units of: &quot;</span><span class="p">,</span> <span class="n">moment_0</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Moment_1 has units of: &quot;</span><span class="p">,</span> <span class="n">moment_1</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>

<span class="c1"># Convert Moment_0 to a Column Density assuming optically thin media</span>
<span class="n">hi_column_density</span> <span class="o">=</span> <span class="n">moment_0</span> <span class="o">*</span> <span class="mf">1.82</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">18</span> <span class="o">/</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Moment_0 has units of:  K km / s
Moment_1 has units of:  km / s
</pre></div>
</div>
</div>
</div>
<p><a id='better_moments'></a></p>
</section>
<section id="display-the-moment-maps">
<h2>Display the Moment Maps<a class="headerlink" href="#display-the-moment-maps" title="Link to this heading">#</a></h2>
<p>The <a class="reference external" href="http://docs.astropy.org/en/stable/visualization/wcsaxes/">WCSAxes</a> framework in Astropy allows us to display images with different coordinate axes and projections.</p>
<p>As long as we have a WCS object associated with the data, we can transfer that projection to a matplotlib axis. SpectralCube makes it possible to access just the WCS object associated with a cube object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">moment_1</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>  <span class="c1"># Examine the WCS object associated with the moment map</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WCS Keywords

Number of WCS axes: 2
CTYPE : &#39;GLON-TAN&#39; &#39;GLAT-TAN&#39; 
CRVAL : 303.75 -40.0 
CRPIX : 11.557620817843869 40.3723930634757 
PC1_1 PC1_2  : 1.0 0.0 
PC2_1 PC2_2  : 0.0 1.0 
CDELT : -0.1494444443846667 0.1538888888273333 
NAXIS : 0  0
</pre></div>
</div>
</div>
</div>
<p>As expected, the first moment image we created only has two axes (Galactic Longitude and Galactic Latitude).  We can pass in this WCS object directly into a matplotlib axis instance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initiate a figure and axis object with WCS projection information</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">moment_1</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>

<span class="c1"># Display the moment map image</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">moment_1</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>  <span class="c1"># Flips the Y axis</span>

<span class="c1"># Add axes labels</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Galactic Longitude (degrees)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Galactic Latitude (degrees)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># Add a colorbar</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.07</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Velocity (km/s)&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># Overlay set of RA/Dec Axes</span>
<span class="n">overlay</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_coords_overlay</span><span class="p">(</span><span class="s2">&quot;fk5&quot;</span><span class="p">)</span>
<span class="n">overlay</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dotted&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">overlay</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_axislabel</span><span class="p">(</span><span class="s2">&quot;Right Ascension (J2000)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">overlay</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_axislabel</span><span class="p">(</span><span class="s2">&quot;Declination (J2000)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># Overplot column density contours</span>
<span class="n">levels</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1e20</span><span class="p">,</span> <span class="mf">5e20</span><span class="p">,</span> <span class="mf">1e21</span><span class="p">,</span> <span class="mf">3e21</span><span class="p">,</span> <span class="mf">5e21</span><span class="p">,</span> <span class="mf">7e21</span><span class="p">,</span> <span class="mf">1e22</span><span class="p">)</span>  <span class="c1"># Define contour levels to use</span>
<span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">hi_column_density</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys_r&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.contour.QuadContourSet at 0x7fa3c84744d0&gt;
</pre></div>
</div>
<img alt="_images/7ea6258532f3b8288f0a99a7b00b5be61254d83625099953158e04a32eefee2e.png" src="_images/7ea6258532f3b8288f0a99a7b00b5be61254d83625099953158e04a32eefee2e.png" />
</div>
</div>
<p>As you can see, the WCSAxes framework is very powerful and similiar to making any matplotlib style plot.</p>
<p><a id='l-v slice'></a></p>
</section>
<section id="display-a-longitude-velocity-slice">
<h2>Display a Longitude-Velocity Slice<a class="headerlink" href="#display-a-longitude-velocity-slice" title="Link to this heading">#</a></h2>
<p>The <a class="reference external" href="http://docs.astropy.org/en/stable/visualization/wcsaxes/">WCSAxes</a> framework in Astropy also lets us slice the data accross different dimensions. It is often useful to slice along a single latitude and display an image showing longtitude and velocity information only (position-velocity or longitude-velocity diagram).</p>
<p>This can be done by specifying the <code class="docutils literal notranslate"><span class="pre">slices</span></code> keyword and selecting the appropriate slice through the data.</p>
<p><code class="docutils literal notranslate"><span class="pre">slices</span></code> requires a 3D tuple containing the index to be sliced along and where we want the two axes to be displayed. This should be specified in the same order as the WCS object (longitude, latitude, velocity) as opposed to the order of numpy array holding the data  (velocity, latitude, longitude).</p>
<p>We then select the appropriate data by indexing along the numpy array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lat_slice</span> <span class="o">=</span> <span class="mi">18</span>  <span class="c1"># Index of latitude dimension to slice along</span>

<span class="c1"># Initiate a figure and axis object with WCS projection information</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">sub_cube_slab</span><span class="o">.</span><span class="n">wcs</span><span class="p">,</span> <span class="n">slices</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">lat_slice</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">))</span>
<span class="c1"># Above, we have specified to plot the longitude along the y axis, pick only the lat_slice</span>
<span class="c1"># indicated, and plot the velocity along the x axis</span>

<span class="c1"># Display the slice</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">sub_cube_slab</span><span class="p">[:,</span> <span class="n">lat_slice</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
<span class="p">)</span>  <span class="c1"># Display the image slice</span>
<span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>  <span class="c1"># Flips the Y axis</span>

<span class="c1"># Add axes labels</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;LSR Velocity (m/s)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Galactic Longitude (degrees)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># Add a colorbar</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Temperature (K)&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: WCSWarning: Slicing across a celestial axis results in an invalid WCS, so the celestial projection (TAN) is being removed.  The WCS indices being kept were [0 2]. [spectral_cube.wcs_utils]
WARNING: WCSWarning: Slicing across a celestial axis results in an invalid WCS, so the celestial projection (TAN) is being removed.  The view used was (slice(None, None, None), 18, slice(None, None, None)). [spectral_cube.wcs_utils]
</pre></div>
</div>
<img alt="_images/3cf78b5ca13f10f3aa2179da4f7aed610b78a12038de74e295efddaf64fa357c.png" src="_images/3cf78b5ca13f10f3aa2179da4f7aed610b78a12038de74e295efddaf64fa357c.png" />
</div>
</div>
<p>As we can see, the SMC seems to be only along positive velocities.</p>
</section>
<section id="try">
<h2>Try:<a class="headerlink" href="#try" title="Link to this heading">#</a></h2>
<section id="create-a-new-spectral-slab-isolating-just-the-smc-and-slice-along-a-different-dimension-to-create-a-latitude-velocity-diagram">
<h3>Create a new spectral slab isolating just the SMC and slice along a different dimension to create a latitude-velocity diagram<a class="headerlink" href="#create-a-new-spectral-slab-isolating-just-the-smc-and-slice-along-a-different-dimension-to-create-a-latitude-velocity-diagram" title="Link to this heading">#</a></h3>
</section>
</section>
<section id="find-and-download-a-herschel-image">
<h2>Find and Download a Herschel Image<a class="headerlink" href="#find-and-download-a-herschel-image" title="Link to this heading">#</a></h2>
<p>This is great, but we want to compare the HI emission data with Herschel 350 micron emission to trace some dust. This can be done with <a class="reference external" href="http://www.astropy.org/astroquery/">astroquery</a>.
We can query for the data by mission, take a quick look at the table of results, and download data after selecting a specific wavelength or filter.</p>
<p>Since we are looking for Herschel data from an ESA mission, we will use the <a class="reference external" href="http://astroquery.readthedocs.io/en/latest/esasky/esasky.html">astroquery.ESASky</a> class.</p>
<p>Specifically, the <code class="docutils literal notranslate"><span class="pre">ESASKY.query_region_maps()</span></code> method allows us to search for a specific region of the sky either using an Astropy SkyCoord object or a string specifying an object name. In this case, we can just search for the SMC. A radius to search around the object can also be specified.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Query for Herschel data in a 1 degree radius around the SMC</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">ESASky</span><span class="o">.</span><span class="n">query_region_maps</span><span class="p">(</span><span class="s2">&quot;SMC&quot;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">missions</span><span class="o">=</span><span class="s2">&quot;Herschel&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TableList with 1 tables:
	&#39;0:HERSCHEL&#39; with 15 column(s) and 28 row(s) 
</pre></div>
</div>
</div>
</div>
<p>Here, the result is a TableList which contains 24 Herschel data products that can be downloaded. We can see what information is available in this TableList by examining the keys in the Herschel Table.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;HERSCHEL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;fov&#39;,
 &#39;postcard_url&#39;,
 &#39;product_url&#39;,
 &#39;observation_id&#39;,
 &#39;observation_oid&#39;,
 &#39;ra_deg&#39;,
 &#39;dec_deg&#39;,
 &#39;target_name&#39;,
 &#39;instrument&#39;,
 &#39;filter&#39;,
 &#39;start_time&#39;,
 &#39;end_time&#39;,
 &#39;duration&#39;,
 &#39;observing_mode_name&#39;,
 &#39;stc_s&#39;]
</pre></div>
</div>
</div>
</div>
<p>We want to find a 350 micron image, so we need to look closer at the filters used for these observations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;HERSCHEL&quot;</span><span class="p">][</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">&lt;MaskedColumn name=&apos;filter&apos; dtype=&apos;object&apos; unit=&apos;microns&apos; description=&apos;Filter or filters used&apos; length=28&gt;
<table>
<tr><td>70, 160</td></tr>
<tr><td>250, 350, 500</td></tr>
<tr><td>100, 160</td></tr>
<tr><td>70, 160</td></tr>
<tr><td>70, 160</td></tr>
<tr><td>70, 160</td></tr>
<tr><td>70, 160</td></tr>
<tr><td>250, 350, 500</td></tr>
<tr><td>100, 160</td></tr>
<tr><td>70, 160</td></tr>
<tr><td>70, 160</td></tr>
<tr><td>70, 160</td></tr>
<tr><td>...</td></tr>
<tr><td>70, 160</td></tr>
<tr><td>100, 160</td></tr>
<tr><td>70, 160</td></tr>
<tr><td>250, 350, 500</td></tr>
<tr><td>70, 160</td></tr>
<tr><td>250, 350, 500</td></tr>
<tr><td>100, 160</td></tr>
<tr><td>70, 160</td></tr>
<tr><td>70, 160</td></tr>
<tr><td>70, 160</td></tr>
<tr><td>250, 350, 500</td></tr>
</table></div></div>
</div>
<p>Luckily for us, there is an observation made with three filters: 250, 350, and 500 microns.  This is the object we will want to download. One way to do this is by making a boolean mask to select out the Table entry corresponding with the desired filter. Then, the <code class="docutils literal notranslate"><span class="pre">ESASky.get_maps()</span></code> method will download our data provided a TableList argument.</p>
<div class="alert alert-info">
Note that the below command requires an internet connection to download five quite large files. It could take several minutes to complete.
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filters</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;HERSCHEL&quot;</span><span class="p">][</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
    <span class="nb">str</span>
<span class="p">)</span>  <span class="c1"># Convert the list of filters from the query to a string</span>

<span class="c1"># Construct a boolean mask, searching for only the desired filters</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;250, 350, 500&quot;</span> <span class="o">==</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;bool&quot;</span><span class="p">)</span>

<span class="c1"># Re-construct a new TableList object containing only our desired query entry</span>
<span class="n">target_obs</span> <span class="o">=</span> <span class="n">TableList</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;HERSCHEL&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;HERSCHEL&quot;</span><span class="p">][</span><span class="n">mask</span><span class="p">]}</span>
<span class="p">)</span>  <span class="c1"># This will be passed into ESASky.get_maps()</span>

<span class="n">IR_images</span> <span class="o">=</span> <span class="n">ESASky</span><span class="o">.</span><span class="n">get_maps</span><span class="p">(</span><span class="n">target_obs</span><span class="p">)</span>  <span class="c1"># Download the images</span>
<span class="n">IR_images</span><span class="p">[</span><span class="s2">&quot;HERSCHEL&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span>
    <span class="s2">&quot;350&quot;</span>
<span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>  <span class="c1"># Display some information about the 350 micron image</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Starting download of HERSCHEL data. (5 files) [astroquery.esasky.core]
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">line</span> <span class="mi">13</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="c1"># Re-construct a new TableList object containing only our desired query entry</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">target_obs</span> <span class="o">=</span> <span class="n">TableList</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="p">{</span><span class="s2">&quot;HERSCHEL&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;HERSCHEL&quot;</span><span class="p">][</span><span class="n">mask</span><span class="p">]}</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="p">)</span>  <span class="c1"># This will be passed into ESASky.get_maps()</span>
<span class="ne">---&gt; </span><span class="mi">13</span> <span class="n">IR_images</span> <span class="o">=</span> <span class="n">ESASky</span><span class="o">.</span><span class="n">get_maps</span><span class="p">(</span><span class="n">target_obs</span><span class="p">)</span>  <span class="c1"># Download the images</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="n">IR_images</span><span class="p">[</span><span class="s2">&quot;HERSCHEL&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>     <span class="s2">&quot;350&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>  <span class="c1"># Display some information about the 350 micron image</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.10/x64/lib/python3.12/site-packages/astroquery/esasky/core.py:1083,</span> in <span class="ni">ESASkyClass.get_maps</span><span class="nt">(self, query_table_list, missions, download_dir, cache, verbose)</span>
<span class="g g-Whitespace">   </span><span class="mi">1080</span>     <span class="k">if</span> <span class="n">query_mission</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">sanitized_missions</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1081</span>         <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_for_mission</span><span class="p">(</span><span class="n">query_mission</span><span class="p">,</span> <span class="n">descriptors</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1082</span>         <span class="n">maps</span><span class="p">[</span><span class="n">query_mission</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
<span class="ne">-&gt; </span><span class="mi">1083</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_get_maps_for_mission</span><span class="p">(</span><span class="n">sanitized_query_table_list</span><span class="p">[</span><span class="n">query_mission</span><span class="p">],</span> <span class="n">query_mission</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1084</span>                                        <span class="n">cache</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">))</span>
<span class="g g-Whitespace">   </span><span class="mi">1086</span> <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">maps</span><span class="p">[</span><span class="n">mission</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="n">mission</span><span class="p">])</span>
<span class="g g-Whitespace">   </span><span class="mi">1087</span>         <span class="k">for</span> <span class="n">mission</span> <span class="ow">in</span> <span class="n">maps</span><span class="p">]):</span>
<span class="g g-Whitespace">   </span><span class="mi">1088</span>     <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No maps got downloaded, check errors above.&quot;</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.10/x64/lib/python3.12/site-packages/astroquery/esasky/core.py:1500,</span> in <span class="ni">ESASkyClass._get_maps_for_mission</span><span class="nt">(self, maps_table, mission, download_dir, cache, table, is_spectra, verbose)</span>
<span class="g g-Whitespace">   </span><span class="mi">1498</span>         <span class="n">maps</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_herschel_spectra</span><span class="p">(</span><span class="n">product_url</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">,</span> <span class="n">cache</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1499</span>     <span class="k">else</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1500</span>         <span class="n">maps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_herschel_map</span><span class="p">(</span><span class="n">product_url</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">,</span> <span class="n">cache</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">))</span>
<span class="g g-Whitespace">   </span><span class="mi">1501</span> <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1502</span>     <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Download failed with </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.10/x64/lib/python3.12/site-packages/astroquery/esasky/core.py:1585,</span> in <span class="ni">ESASkyClass._get_herschel_map</span><span class="nt">(self, product_url, directory_path, cache, verbose)</span>
<span class="g g-Whitespace">   </span><span class="mi">1583</span> <span class="k">def</span><span class="w"> </span><span class="nf">_get_herschel_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product_url</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">,</span> <span class="n">cache</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1584</span>     <span class="n">observation</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="ne">-&gt; </span><span class="mi">1585</span>     <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">product_url</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1586</span>                              <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_header</span><span class="p">())</span>
<span class="g g-Whitespace">   </span><span class="mi">1587</span>     <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1589</span>     <span class="k">with</span> <span class="n">esatar</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">))</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.10/x64/lib/python3.12/site-packages/astroquery/query.py:386,</span> in <span class="ni">BaseQuery._request</span><span class="nt">(self, method, url, params, data, headers, files, save, savedir, timeout, cache, stream, auth, continuation, verify, allow_redirects, json, return_response_on_save)</span>
<span class="g g-Whitespace">    </span><span class="mi">378</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">379</span>         <span class="n">response</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">380</span>                                  <span class="bp">self</span><span class="o">.</span><span class="n">cache_location</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">381</span>                                  <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>    <span class="mi">384</span>                                  <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">385</span>                                  <span class="n">json</span><span class="o">=</span><span class="n">json</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">386</span>         <span class="n">to_cache</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">query</span><span class="o">.</span><span class="n">request_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_location</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">388</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_query</span> <span class="o">=</span> <span class="n">query</span>
<span class="g g-Whitespace">    </span><span class="mi">389</span> <span class="k">return</span> <span class="n">response</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.10/x64/lib/python3.12/site-packages/astroquery/query.py:36,</span> in <span class="ni">to_cache</span><span class="nt">(response, cache_file)</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="k">def</span><span class="w"> </span><span class="nf">to_cache</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">cache_file</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span>     <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Caching data to </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cache_file</span><span class="p">))</span>
<span class="ne">---&gt; </span><span class="mi">36</span>     <span class="n">response</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">37</span>     <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;request&#39;</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">38</span>         <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">hooks</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.10/x64/lib/python3.12/copy.py:151,</span> in <span class="ni">deepcopy</span><span class="nt">(x, memo, _nil)</span>
<span class="g g-Whitespace">    </span><span class="mi">149</span> <span class="n">reductor</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;__reduce_ex__&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">150</span> <span class="k">if</span> <span class="n">reductor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">151</span>     <span class="n">rv</span> <span class="o">=</span> <span class="n">reductor</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">152</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">153</span>     <span class="n">reductor</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;__reduce__&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.10/x64/lib/python3.12/site-packages/requests/models.py:715,</span> in <span class="ni">Response.__getstate__</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">711</span> <span class="k">def</span><span class="w"> </span><span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">712</span>     <span class="c1"># Consume everything; accessing the content attribute makes</span>
<span class="g g-Whitespace">    </span><span class="mi">713</span>     <span class="c1"># sure the content has been fully read.</span>
<span class="g g-Whitespace">    </span><span class="mi">714</span>     <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_content_consumed</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">715</span>         <span class="bp">self</span><span class="o">.</span><span class="n">content</span>
<span class="g g-Whitespace">    </span><span class="mi">717</span>     <span class="k">return</span> <span class="p">{</span><span class="n">attr</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__attrs__</span><span class="p">}</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.10/x64/lib/python3.12/site-packages/requests/models.py:902,</span> in <span class="ni">Response.content</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">900</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">901</span>     <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">902</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">CONTENT_CHUNK_SIZE</span><span class="p">))</span> <span class="ow">or</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">904</span> <span class="bp">self</span><span class="o">.</span><span class="n">_content_consumed</span> <span class="o">=</span> <span class="kc">True</span>
<span class="g g-Whitespace">    </span><span class="mi">905</span> <span class="c1"># don&#39;t need to release the connection; that&#39;s been handled by urllib3</span>
<span class="g g-Whitespace">    </span><span class="mi">906</span> <span class="c1"># since we exhausted the data.</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.10/x64/lib/python3.12/site-packages/requests/models.py:820,</span> in <span class="ni">Response.iter_content.&lt;locals&gt;.generate</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">818</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="p">,</span> <span class="s2">&quot;stream&quot;</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">819</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">820</span>         <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">,</span> <span class="n">decode_content</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">821</span>     <span class="k">except</span> <span class="n">ProtocolError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">822</span>         <span class="k">raise</span> <span class="n">ChunkedEncodingError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.10/x64/lib/python3.12/site-packages/urllib3/response.py:1088,</span> in <span class="ni">HTTPResponse.stream</span><span class="nt">(self, amt, decode_content)</span>
<span class="g g-Whitespace">   </span><span class="mi">1072</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1073</span><span class="sd"> A generator wrapper for the read() method. A call will block until</span>
<span class="g g-Whitespace">   </span><span class="mi">1074</span><span class="sd"> ``amt`` bytes have been read from the connection or until the</span>
<span class="sd">   (...)   1085     &#39;content-encoding&#39; header.</span>
<span class="g g-Whitespace">   </span><span class="mi">1086</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1087</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunked</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">supports_chunked_reads</span><span class="p">():</span>
<span class="ne">-&gt; </span><span class="mi">1088</span>     <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_chunked</span><span class="p">(</span><span class="n">amt</span><span class="p">,</span> <span class="n">decode_content</span><span class="o">=</span><span class="n">decode_content</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1089</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1090</span>     <span class="k">while</span> <span class="ow">not</span> <span class="n">is_fp_closed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_decoded_buffer</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.10/x64/lib/python3.12/site-packages/urllib3/response.py:1251,</span> in <span class="ni">HTTPResponse.read_chunked</span><span class="nt">(self, amt, decode_content)</span>
<span class="g g-Whitespace">   </span><span class="mi">1249</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_left</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1250</span>     <span class="k">break</span>
<span class="ne">-&gt; </span><span class="mi">1251</span> <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_chunk</span><span class="p">(</span><span class="n">amt</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1252</span> <span class="n">decoded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1253</span>     <span class="n">chunk</span><span class="p">,</span> <span class="n">decode_content</span><span class="o">=</span><span class="n">decode_content</span><span class="p">,</span> <span class="n">flush_decoder</span><span class="o">=</span><span class="kc">False</span>
<span class="g g-Whitespace">   </span><span class="mi">1254</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1255</span> <span class="k">if</span> <span class="n">decoded</span><span class="p">:</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.10/x64/lib/python3.12/site-packages/urllib3/response.py:1197,</span> in <span class="ni">HTTPResponse._handle_chunk</span><span class="nt">(self, amt)</span>
<span class="g g-Whitespace">   </span><span class="mi">1195</span>     <span class="n">returned_chunk</span> <span class="o">=</span> <span class="n">value</span>
<span class="g g-Whitespace">   </span><span class="mi">1196</span> <span class="k">else</span><span class="p">:</span>  <span class="c1"># amt &gt; self.chunk_left</span>
<span class="ne">-&gt; </span><span class="mi">1197</span>     <span class="n">returned_chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">_safe_read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk_left</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
<span class="g g-Whitespace">   </span><span class="mi">1198</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">_safe_read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr] # Toss the CRLF at the end of the chunk.</span>
<span class="g g-Whitespace">   </span><span class="mi">1199</span>     <span class="bp">self</span><span class="o">.</span><span class="n">chunk_left</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.10/x64/lib/python3.12/http/client.py:642,</span> in <span class="ni">HTTPResponse._safe_read</span><span class="nt">(self, amt)</span>
<span class="g g-Whitespace">    </span><span class="mi">635</span> <span class="k">def</span><span class="w"> </span><span class="nf">_safe_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amt</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">636</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Read the number of bytes requested.</span>
<span class="g g-Whitespace">    </span><span class="mi">637</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">638</span><span class="sd">     This function should be used when &lt;amt&gt; bytes &quot;should&quot; be present for</span>
<span class="g g-Whitespace">    </span><span class="mi">639</span><span class="sd">     reading. If the bytes are truly not available (due to EOF), then the</span>
<span class="g g-Whitespace">    </span><span class="mi">640</span><span class="sd">     IncompleteRead exception can be used to detect the problem.</span>
<span class="g g-Whitespace">    </span><span class="mi">641</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">642</span>     <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">amt</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">643</span>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">amt</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">644</span>         <span class="k">raise</span> <span class="n">IncompleteRead</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">amt</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.10/x64/lib/python3.12/socket.py:720,</span> in <span class="ni">SocketIO.readinto</span><span class="nt">(self, b)</span>
<span class="g g-Whitespace">    </span><span class="mi">718</span> <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">719</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">720</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sock</span><span class="o">.</span><span class="n">recv_into</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">721</span>     <span class="k">except</span> <span class="n">timeout</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">722</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_timeout_occurred</span> <span class="o">=</span> <span class="kc">True</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<p>Since we are just doing some qualitative analysis, we only need the image, but you can also access lots of other information from our downloaded object, such as errors.</p>
<p>Let’s go ahead and extract just the WCS information and image data from the 350 micron image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">herschel_header</span> <span class="o">=</span> <span class="n">IR_images</span><span class="p">[</span><span class="s2">&quot;HERSCHEL&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;350&quot;</span><span class="p">][</span><span class="s2">&quot;image&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
<span class="n">herschel_wcs</span> <span class="o">=</span> <span class="n">WCS</span><span class="p">(</span><span class="n">IR_images</span><span class="p">[</span><span class="s2">&quot;HERSCHEL&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;350&quot;</span><span class="p">][</span><span class="s2">&quot;image&quot;</span><span class="p">])</span>  <span class="c1"># Extract WCS information</span>
<span class="n">herschel_imagehdu</span> <span class="o">=</span> <span class="n">IR_images</span><span class="p">[</span><span class="s2">&quot;HERSCHEL&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;350&quot;</span><span class="p">][</span><span class="s2">&quot;image&quot;</span><span class="p">]</span>  <span class="c1"># Extract Image data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">herschel_wcs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>With this, we can display this image using matplotlib with <a class="reference external" href="http://docs.astropy.org/en/stable/visualization/wcsaxes/index.html">WCSAxes</a> and the <code class="docutils literal notranslate"><span class="pre">LogNorm()</span></code> object so we can log scale our image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set Nans to zero</span>
<span class="n">himage_nan_locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">herschel_imagehdu</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">herschel_data_nonans</span> <span class="o">=</span> <span class="n">herschel_imagehdu</span><span class="o">.</span><span class="n">data</span>
<span class="n">herschel_data_nonans</span><span class="p">[</span><span class="n">himage_nan_locs</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Initiate a figure and axis object with WCS projection information</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">herschel_wcs</span><span class="p">)</span>

<span class="c1"># Display the moment map image</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">herschel_data_nonans</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">50</span><span class="p">))</span>
<span class="c1"># ax.invert_yaxis() # Flips the Y axis</span>

<span class="c1"># Add axes labels</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Right Ascension&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Declination&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dotted&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Add a colorbar</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.07</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span>
    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;Herschel 350&quot;</span> <span class="sa">r</span><span class="s2">&quot;$\mu$m &quot;</span><span class="p">,</span> <span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="n">herschel_header</span><span class="p">[</span><span class="s2">&quot;BUNIT&quot;</span><span class="p">],</span> <span class="s2">&quot;)&quot;</span><span class="p">]),</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span>
<span class="p">)</span>

<span class="c1"># Overlay set of Galactic Coordinate Axes</span>
<span class="n">overlay</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_coords_overlay</span><span class="p">(</span><span class="s2">&quot;galactic&quot;</span><span class="p">)</span>
<span class="n">overlay</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dotted&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">overlay</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_axislabel</span><span class="p">(</span><span class="s2">&quot;Galactic Longitude&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">overlay</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_axislabel</span><span class="p">(</span><span class="s2">&quot;Galactic Latitude&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="overlay-hi-21-cm-contours-on-the-ir-30-micron-image">
<h2>Overlay HI 21 cm Contours on the IR 30 micron Image<a class="headerlink" href="#overlay-hi-21-cm-contours-on-the-ir-30-micron-image" title="Link to this heading">#</a></h2>
<p>To visually compare the neutral gas and dust as traced by HI 21 cm emission and IR 30 micron emission, we can use contours and colorscale images produced using the <a class="reference external" href="http://docs.astropy.org/en/stable/visualization/wcsaxes/index.html">WCSAxes</a> framework and the <code class="docutils literal notranslate"><span class="pre">.get_transform()</span></code> method.</p>
<p>The <a class="reference external" href="http://docs.astropy.org/en/stable/api/astropy.visualization.wcsaxes.WCSAxes.html#astropy.visualization.wcsaxes.WCSAxes.get_transform">WCSAxes.get_transform()</a> method returns a transformation from a specified frame to the pixel/data coordinates. It accepts a string specifying the frame or a WCS object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initiate a figure and axis object with WCS projection information</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">herschel_wcs</span><span class="p">)</span>

<span class="c1"># Display the moment map image</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">herschel_data_nonans</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span>
<span class="p">)</span>
<span class="c1"># ax.invert_yaxis() # Flips the Y axis</span>

<span class="c1"># Add axes labels</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Right Ascension&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Declination&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dotted&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Extract x and y coordinate limits</span>
<span class="n">x_lim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
<span class="n">y_lim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

<span class="c1"># Add a colorbar</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span>
    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;Herschel 350&quot;</span> <span class="sa">r</span><span class="s2">&quot;$\mu$m &quot;</span><span class="p">,</span> <span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="n">herschel_header</span><span class="p">[</span><span class="s2">&quot;BUNIT&quot;</span><span class="p">],</span> <span class="s2">&quot;)&quot;</span><span class="p">]),</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span>
<span class="p">)</span>

<span class="c1"># Overlay set of RA/Dec Axes</span>
<span class="n">overlay</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_coords_overlay</span><span class="p">(</span><span class="s2">&quot;galactic&quot;</span><span class="p">)</span>
<span class="n">overlay</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dotted&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">overlay</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_axislabel</span><span class="p">(</span><span class="s2">&quot;Galactic Longitude&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">overlay</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_axislabel</span><span class="p">(</span><span class="s2">&quot;Galactic Latitude&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">hi_transform</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span>
    <span class="n">hi_column_density</span><span class="o">.</span><span class="n">wcs</span>
<span class="p">)</span>  <span class="c1"># extract axes Transform information for the HI data</span>

<span class="c1"># Overplot column density contours</span>
<span class="n">levels</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2e21</span><span class="p">,</span> <span class="mf">3e21</span><span class="p">,</span> <span class="mf">5e21</span><span class="p">,</span> <span class="mf">7e21</span><span class="p">,</span> <span class="mf">8e21</span><span class="p">,</span> <span class="mf">1e22</span><span class="p">)</span>  <span class="c1"># Define contour levels to use</span>
<span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
    <span class="n">hi_column_density</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys_r&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">hi_transform</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># include the transform information with the keyword &quot;transform&quot;</span>

<span class="c1"># Overplot velocity image so we can also see the Gas velocities</span>
<span class="n">im_hi</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">moment_1</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">hi_transform</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Add a second colorbar for the HI Velocity information</span>
<span class="n">cbar_hi</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im_hi</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.07</span><span class="p">)</span>
<span class="n">cbar_hi</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;HI &quot;</span> <span class="sa">r</span><span class="s2">&quot;$21$cm Mean Velocity (km/s)&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># Apply original image x and y coordinate limits</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="using-reproject-to-match-image-resolutions">
<h2>Using reproject to match image resolutions<a class="headerlink" href="#using-reproject-to-match-image-resolutions" title="Link to this heading">#</a></h2>
<p>The <a class="reference external" href="https://reproject.readthedocs.io/en/stable/">reproject</a> package is a powerful tool allowing for image data to be transformed into a variety of projections and resolutions.  It’s most powerful use is in fact to transform data from one map projection to another without losing any information and still properly conserving flux values within the data. It even has a method to perform a fast reprojection if you are not too concerned with the absolute accuracy of the data values.</p>
<p>A simple use of the reproject package is to scale down (or up) resolutions of an image artificially. This could be a useful step if you are trying to get emission line ratios or directly compare the Intensity or Flux from a tracer to that of another tracer in the same physical point of the sky.</p>
<p>From our previously made images, we can see that the IR Herschel Image has a higher spatial resolution than that of the HI data cube. We can look into this more by taking a better look at both header objects and using reproject to downscale the Herschel Image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IR Resolution (dx,dy) = &quot;</span><span class="p">,</span> <span class="n">herschel_header</span><span class="p">[</span><span class="s2">&quot;cdelt1&quot;</span><span class="p">],</span> <span class="n">herschel_header</span><span class="p">[</span><span class="s2">&quot;cdelt2&quot;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;HI Resolution (dx,dy) = &quot;</span><span class="p">,</span>
    <span class="n">hi_column_density</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;cdelt1&quot;</span><span class="p">],</span>
    <span class="n">hi_column_density</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;cdelt1&quot;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="alert alert-info">
Note: Different ways of accessing the header are shown above corresponding to the different object types (coming from SpectralCube vs astropy.io.fits)
</div> 
<p>As we can see, the IR data has over 10 times higher spatial resolution. In order to create a new projection of an image, all we need to specifiy is a new header containing WCS information to transform into.  These can be created manually if you wanted to completely change something about the projection type (i.e. going from a Mercator map projection to a Tangential map projection). For us, since we want to match our resolutions, we can just “steal” the WCS object from the HI data. Specifically, we will be using the <a class="reference external" href="https://reproject.readthedocs.io/en/stable/api/reproject.reproject_interp.html#reproject.reproject_interp">reproject_interp()</a> function. This takes two arguments: an HDU object that you want to reproject, and a header containing WCS information to reproject onto.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rescaled_herschel_data</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">reproject_interp</span><span class="p">(</span>
    <span class="n">herschel_imagehdu</span><span class="p">,</span>
    <span class="c1"># reproject the Herschal image to match the HI data</span>
    <span class="n">hi_column_density</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">rescaled_herschel_imagehdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">rescaled_herschel_data</span><span class="p">,</span>
    <span class="c1"># wrap up our reprojection as a new fits HDU object</span>
    <span class="n">header</span><span class="o">=</span><span class="n">hi_column_density</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">rescaled_herschel_imagehdu</span></code> will now behave just like the other FITS images we have been working with, but now with a degraded resolution matching the HI data. This includes having its native coordinates in Galactic rather than RA and Dec.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set Nans to zero</span>
<span class="n">image_nan_locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">rescaled_herschel_imagehdu</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">rescaled_herschel_data_nonans</span> <span class="o">=</span> <span class="n">rescaled_herschel_imagehdu</span><span class="o">.</span><span class="n">data</span>
<span class="n">rescaled_herschel_data_nonans</span><span class="p">[</span><span class="n">image_nan_locs</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Initiate a figure and axis object with WCS projection information</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">WCS</span><span class="p">(</span><span class="n">rescaled_herschel_imagehdu</span><span class="p">))</span>

<span class="c1"># Display the moment map image</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">rescaled_herschel_data_nonans</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
    <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># im = ax.imshow(rescaled_herschel_imagehdu.data, cmap = &#39;viridis&#39;,</span>
<span class="c1">#               norm = LogNorm(), vmin = 5, vmax = 50, alpha = .8)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>  <span class="c1"># Flips the Y axis</span>

<span class="c1"># Add axes labels</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Galactic Longitude&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Galactic Latitude&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dotted&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Extract x and y coordinate limits</span>
<span class="n">x_lim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
<span class="n">y_lim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

<span class="c1"># Add a colorbar</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span>
    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;Herschel 350&quot;</span> <span class="sa">r</span><span class="s2">&quot;$\mu$m &quot;</span><span class="p">,</span> <span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="n">herschel_header</span><span class="p">[</span><span class="s2">&quot;BUNIT&quot;</span><span class="p">],</span> <span class="s2">&quot;)&quot;</span><span class="p">]),</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span>
<span class="p">)</span>

<span class="c1"># Overlay set of RA/Dec Axes</span>
<span class="n">overlay</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_coords_overlay</span><span class="p">(</span><span class="s2">&quot;fk5&quot;</span><span class="p">)</span>
<span class="n">overlay</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dotted&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">overlay</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_axislabel</span><span class="p">(</span><span class="s2">&quot;Right Ascension&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">overlay</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_axislabel</span><span class="p">(</span><span class="s2">&quot;Declination&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">hi_transform</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span>
    <span class="n">hi_column_density</span><span class="o">.</span><span class="n">wcs</span>
<span class="p">)</span>  <span class="c1"># extract axes Transform information for the HI data</span>

<span class="c1"># Overplot column density contours</span>
<span class="n">levels</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2e21</span><span class="p">,</span> <span class="mf">3e21</span><span class="p">,</span> <span class="mf">5e21</span><span class="p">,</span> <span class="mf">7e21</span><span class="p">,</span> <span class="mf">8e21</span><span class="p">,</span> <span class="mf">1e22</span><span class="p">)</span>  <span class="c1"># Define contour levels to use</span>
<span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
    <span class="n">hi_column_density</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys_r&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">hi_transform</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># include the transform information with the keyword &quot;transform&quot;</span>

<span class="c1"># Overplot velocity image so we can also see the Gas velocities</span>
<span class="n">im_hi</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">moment_1</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">hi_transform</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Add a second colorbar for the HI Velocity information</span>
<span class="n">cbar_hi</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im_hi</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.07</span><span class="p">)</span>
<span class="n">cbar_hi</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;HI &quot;</span> <span class="sa">r</span><span class="s2">&quot;$21$cm Mean Velocity (km/s)&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># Apply original image x and y coordinate limits</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The real power of reproject is in actually changing the map projection used to display the data.  This is done by creating a WCS object that contains a different projection type such as <code class="docutils literal notranslate"><span class="pre">CTYPE</span> <span class="pre">:</span> <span class="pre">'RA---CAR'</span>&#160; <span class="pre">'DEC--CAR'</span></code> as opposed to <code class="docutils literal notranslate"><span class="pre">CTYPE</span> <span class="pre">:</span> <span class="pre">'RA---TAN'</span>&#160; <span class="pre">'DEC--TAN'</span></code>.</p>
</section>
<section id="challenge">
<h2>Challenge:<a class="headerlink" href="#challenge" title="Link to this heading">#</a></h2>
<p>Use <a class="reference external" href="https://reproject.readthedocs.io/en/stable/#">reproject</a> and WCS to create a new WCS object in a different map projection and see how distortions in the image can change.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "astropy-learn/tutorial--FITS-cubes",
            ref: "main/",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By AUTHOR1 (@GITHUB-USERNAME, ORCID-ID), AUTHOR2 (@GITHUB-USERNAME, ORCID-ID)
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>