
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Astropy Coordinates</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=720ed60b" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-ZBXC3EFGGJ"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-ZBXC3EFGGJ');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-ZBXC3EFGGJ');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'index-coordinates';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="#">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.svg" class="logo__image only-light" alt="None - Home"/>
    <script>document.write(`<img src="_static/logo.svg" class="logo__image only-dark" alt="None - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1 current active">
                <a class="reference internal" href="#">
                    <no title>
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">




</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/astropy-learn/tutorial--astropy-coordinates" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/astropy-learn/tutorial--astropy-coordinates/issues/new?title=Issue%20on%20page%20%2Findex-coordinates.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1><no title></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#document-1_Coordinates-Intro">Astronomical Coordinates 1: Getting Started with astropy.coordinates</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#document-2_Coordinates-Transforms">Astronomical Coordinates 2: Transforming Coordinate Systems and Representations</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#document-3_Coordinates-Velocities">Astronomical Coordinates 3: Working with Velocity Data in astropy.coordinates</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#document-4_Coordinates-Crossmatch">Astronomical Coordinates 4: Cross-matching Catalogs Using astropy.coordinates and astroquery</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p>This is a set of tutorials on how to use the <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> package to work with astronomical coordinates.
We will introduce many of the key concepts underlying how to represent and transform astronomical coordinates using <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code>, including how to work with both position and velocity data within the coordinate objects. We will also explore how the <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> package can be used to cross-match two catalogs that contain overlapping sources that may have been observed at different times.</p>
<div class="toctree-wrapper compound">
<span id="document-1_Coordinates-Intro"></span><section class="tex2jax_ignore mathjax_ignore" id="astronomical-coordinates-1-getting-started-with-astropy-coordinates">
<h1>Astronomical Coordinates 1: Getting Started with astropy.coordinates<a class="headerlink" href="#astronomical-coordinates-1-getting-started-with-astropy-coordinates" title="Link to this heading">#</a></h1>
<section id="authors">
<h2>Authors<a class="headerlink" href="#authors" title="Link to this heading">#</a></h2>
<p>Adrian Price-Whelan</p>
</section>
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Create <code class="docutils literal notranslate"><span class="pre">astropy.coordinates.SkyCoord</span></code> objects using coordinate data and object names</p></li>
<li><p>Use SkyCoord objects to become familiar with object oriented programming (OOP)</p></li>
<li><p>Use a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object to query the <em>Gaia</em> archive using <code class="docutils literal notranslate"><span class="pre">astroquery</span></code></p></li>
<li><p>Output coordinate data in different string representations</p></li>
<li><p>Demonstrate working with 3D sky coordinates (including distance information for objects)</p></li>
</ul>
</section>
<section id="keywords">
<h2>Keywords<a class="headerlink" href="#keywords" title="Link to this heading">#</a></h2>
<p>coordinates, OOP, astroquery, gaia</p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>Astronomers use a wide variety of coordinate systems and formats to represent sky coordinates of celestial objects. For example, you may have seen terms like “right ascension” and “declination” or “galactic latitude and longitude,” and you may have seen angular coordinate components represented as “0h39m15.9s,” “00:39:15.9,” or 9.81625º. The subpackage <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> provides tools for representing the coordinates of objects and transforming them between different systems.</p>
<p>In this tutorial, we will explore how the <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> package can be used to work with astronomical coordinates. You may find it helpful to keep <a class="reference external" href="http://docs.astropy.org/en/stable/coordinates/index.html">the Astropy documentation for the coordinates package</a> open alongside this tutorial for reference or additional reading. In the text below, you may also see some links that look like (<a class="reference external" href="http://docs.astropy.org/en/stable/coordinates/index.html">docs</a>). These links will take you to parts of the documentation that are directly relevant to the cells from which they link.</p>
<p><em>Note: This is the 1st tutorial in a series of tutorials about astropy.coordinates.</em></p>
</section>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h2>
<p>We start by importing some packages that we will need below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">astropy</span><span class="w"> </span><span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.coordinates</span><span class="w"> </span><span class="kn">import</span> <span class="n">SkyCoord</span><span class="p">,</span> <span class="n">Distance</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTable</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.gaia</span><span class="w"> </span><span class="kn">import</span> <span class="n">Gaia</span>

<span class="n">Gaia</span><span class="o">.</span><span class="n">ROW_LIMIT</span> <span class="o">=</span> <span class="mi">10000</span>  <span class="c1"># Set the row limit for returned data</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="representing-on-sky-positions-with-astropy-coordinates">
<h2>Representing On-sky Positions with <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code><a class="headerlink" href="#representing-on-sky-positions-with-astropy-coordinates" title="Link to this heading">#</a></h2>
<p>In Astropy, the most common way of representing and working with sky coordinates is to use the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object (<a class="reference external" href="https://docs.astropy.org/en/stable/coordinates/skycoord.html">docs</a>). A <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> can be created directly from angles or arrays of angles with associated units, as demonstrated below.</p>
<p>To get started, let’s assume that we want to create a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object for the center of the open star cluster NGC 188 so that later we can query and retrieve stars that might be members of the cluster. Let’s also assume, for now, that we already know the sky coordinates of the cluster to be (12.11, 85.26) degrees in the ICRS coordinate frame. The ICRS — sometimes referred to as “equatorial” or “J2000” coordinates (<a class="reference external" href="https://arxiv.org/abs/astro-ph/0602086">more info about the ICRS</a>) — is currently the most common astronomical coordinate frame for stellar or extragalactic astronomy, and is the default coordinate frame for <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code>. Since we already know the ICRS position of NGC 188 (see above), we can create a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object for the cluster by passing the data in to the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> initializer:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngc188_center</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mf">12.11</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="mf">85.26</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<span class="n">ngc188_center</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (ICRS): (ra, dec) in deg
    (12.11, 85.26)&gt;
</pre></div>
</div>
</div>
</div>
<p>Even though the default frame is ICRS, it is generally recommended to explicitly specify the frame your coordinates are in. In this case, this would be an equivalent way of creating our <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object for NGC 188:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngc188_center</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mf">12.11</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="mf">85.26</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">)</span>
<span class="n">ngc188_center</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (ICRS): (ra, dec) in deg
    (12.11, 85.26)&gt;
</pre></div>
</div>
</div>
</div>
<p>As we will see later on in this series, there are many other supported coordinate frames, so it helps to get into the habit of passing in the name of a coordinate frame.</p>
<p>In the above initializations, we passed in <code class="docutils literal notranslate"><span class="pre">astropy.units.Quantity</span></code> objects with angular units to specify the angular components of our sky coordinates. The <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> initializer will also accept string-formatted coordinates either as separate strings for Right Ascension (RA) and Declination (Dec) or a single string. For example, if we have sexagesimal sky coordinate data: In this case, the representation of the data includes specifications of the units (the “hms” for “hour minute second”, and the “dms” for “degrees minute second”</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SkyCoord</span><span class="p">(</span><span class="s2">&quot;00h48m26.4s&quot;</span><span class="p">,</span> <span class="s2">&quot;85d15m36s&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (ICRS): (ra, dec) in deg
    (12.11, 85.26)&gt;
</pre></div>
</div>
</div>
</div>
<p>Some string representations do not explicitly define units, so it is sometimes necessary to specify the units of the string coordinate data explicitly if they are not implicitly included:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SkyCoord</span><span class="p">(</span><span class="s2">&quot;00:48:26.4 85:15:36&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">),</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (ICRS): (ra, dec) in deg
    (12.11, 85.26)&gt;
</pre></div>
</div>
</div>
</div>
<p>For more information and examples on initializing <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> objects, <a class="reference external" href="http://docs.astropy.org/en/latest/coordinates/skycoord.html">see this documentation</a>.</p>
<p>For the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> initializations demonstrated above, we assumed that we already had the coordinate component values ready. If you do not know the coordinate values and the object you are interested in is in <a class="reference external" href="http://cdsweb.u-strasbg.fr/cgi-bin/Sesame">SESAME</a>, you can also automatically look up and load coordinate values from the name of the object using the <code class="docutils literal notranslate"><span class="pre">SkyCoord.from_name()</span></code> class method<sup>1</sup> (<a class="reference external" href="http://docs.astropy.org/en/latest/coordinates/index.html#convenience-methods">docs</a>). Note, however, that this requires an internet connection. It is safe to skip this cell if you are not connected to the internet because we already defined the object <code class="docutils literal notranslate"><span class="pre">ngc188_center</span></code> in the cells above.</p>
<p><sub> <sup>1</sup>If you do not know what a class method is, think of it like an alternative constructor for a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object — calling <code class="docutils literal notranslate"><span class="pre">SkyCoord.from_name()</span></code> with a name gives you a new <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object. For more detailed background on what class methods are and when they’re useful, see <a class="reference external" href="https://julien.danjou.info/blog/2013/guide-python-static-class-abstract-methods">this page</a>.</sub></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngc188_center</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="o">.</span><span class="n">from_name</span><span class="p">(</span><span class="s2">&quot;NGC 188&quot;</span><span class="p">)</span>
<span class="n">ngc188_center</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (ICRS): (ra, dec) in deg
    (11.8117, 85.245)&gt;
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object that we defined now has various ways of accessing the coordinate information contained within it. All <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> objects have attributes that allow you to retrieve the coordinate component data, but the component names will change depending on the coordinate frame of the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> you have. In our examples we have created a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> in the ICRS frame, so the component names are lower-case abbreviations of Right Ascension, <code class="docutils literal notranslate"><span class="pre">.ra</span></code>, and Declination, <code class="docutils literal notranslate"><span class="pre">.dec</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngc188_center</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="n">ngc188_center</span><span class="o">.</span><span class="n">dec</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Longitude 11.8117 deg&gt;, &lt;Latitude 85.245 deg&gt;)
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> component attributes (here <code class="docutils literal notranslate"><span class="pre">ra</span></code> and <code class="docutils literal notranslate"><span class="pre">dec</span></code>) return specialized <code class="docutils literal notranslate"><span class="pre">Quantity</span></code>-like objects that make working with angular data easier. While <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> (<a class="reference external" href="http://docs.astropy.org/en/stable/units/index.html">docs</a>) is a general class that represents numerical values and physical units of any kind, <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> defines subclasses of <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> that are specifically designed for working with angles, such as the <code class="docutils literal notranslate"><span class="pre">Angle</span></code> (<a class="reference external" href="http://docs.astropy.org/en/stable/api/astropy.coordinates.Angle.html">docs</a>) class. The <code class="docutils literal notranslate"><span class="pre">Angle</span></code> class then has additional, more specialized subclasses <code class="docutils literal notranslate"><span class="pre">Latitude</span></code> (<a class="reference external" href="http://docs.astropy.org/en/stable/api/astropy.coordinates.Latitude.html">docs</a>) and <code class="docutils literal notranslate"><span class="pre">Longitude</span></code> (<a class="reference external" href="http://docs.astropy.org/en/stable/api/astropy.coordinates.Longitude.html">docs</a>). These objects store angles, provide useful attributes to quickly convert to common angular units, and enable formatting the numerical values in various formats. For example, in a Jupyter notebook, these objects know how to represent themselves using LaTeX:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngc188_center</span><span class="o">.</span><span class="n">ra</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[11^\circ48{}^\prime42.12{}^{\prime\prime}\]</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngc188_center</span><span class="o">.</span><span class="n">dec</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[85^\circ14{}^\prime42{}^{\prime\prime}\]</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">ngc188_center</span><span class="o">.</span><span class="n">ra</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">ngc188_center</span><span class="o">.</span><span class="n">dec</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(astropy.coordinates.angles.core.Longitude,
 astropy.coordinates.angles.core.Latitude)
</pre></div>
</div>
</div>
</div>
<p>With these objects, we can retrieve the coordinate components in different units using the <code class="docutils literal notranslate"><span class="pre">Quantity.to()</span></code> method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">ngc188_center</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">hourangle</span><span class="p">),</span>
    <span class="n">ngc188_center</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">radian</span><span class="p">),</span>
    <span class="n">ngc188_center</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Longitude 0.78744667 hourangle&gt;,
 &lt;Longitude 0.20615306 rad&gt;,
 &lt;Longitude 11.8117 deg&gt;)
</pre></div>
</div>
</div>
</div>
<p>Or using the shorthand attributes, which return only the component values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ngc188_center</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">ngc188_center</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">radian</span><span class="p">,</span> <span class="n">ngc188_center</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">degree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(np.float64(0.7874466666666669),
 np.float64(0.20615305525781422),
 np.float64(11.8117))
</pre></div>
</div>
</div>
</div>
<p>We can also format the values into strings with specified units (<a class="reference external" href="http://docs.astropy.org/en/latest/coordinates/formatting.html">docs</a>), for example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngc188_center</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">hourangle</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.str_(&#39;00:47:14.808&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="querying-the-gaia-archive-to-retrieve-coordinates-of-stars-in-ngc-188">
<h2>Querying the <em>Gaia</em> Archive to Retrieve Coordinates of Stars in NGC 188<a class="headerlink" href="#querying-the-gaia-archive-to-retrieve-coordinates-of-stars-in-ngc-188" title="Link to this heading">#</a></h2>
<p>Now that we have a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object for the center of NGC 188, we can use this object with the <code class="docutils literal notranslate"><span class="pre">astroquery</span></code> package to query many different astronomical databases (see a full list of <a class="reference external" href="https://astroquery.readthedocs.io/en/latest/#available-services">available services in the astroquery documentation</a>). Here, we will use the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object <code class="docutils literal notranslate"><span class="pre">ngc188_center</span></code> to select sources from the <em>Gaia</em> Data Release 2 catalog around the position of the center of NGC 188 to look for stars that might be members of the star cluster. To do this, we will use the <code class="docutils literal notranslate"><span class="pre">astroquery.gaia</span></code> subpackage (<a class="reference external" href="https://astroquery.readthedocs.io/en/latest/gaia/gaia.html">docs</a>).</p>
<p>This requires an internet connection, but if it fails, the catalog file is included in the repository so you can load it locally (skip the next cell if you do not have an internet connection):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span> <span class="o">=</span> <span class="n">Gaia</span><span class="o">.</span><span class="n">cone_search_async</span><span class="p">(</span><span class="n">ngc188_center</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<span class="n">ngc188_table</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">get_results</span><span class="p">()</span>

<span class="c1"># only keep stars brighter than G=19 magnitude</span>
<span class="n">ngc188_table</span> <span class="o">=</span> <span class="n">ngc188_table</span><span class="p">[</span><span class="n">ngc188_table</span><span class="p">[</span><span class="s2">&quot;phot_g_mean_mag&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">19</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mag</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Query finished. [astroquery.utils.tap.core]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;source_id&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ra&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dec&quot;</span><span class="p">,</span>
    <span class="s2">&quot;parallax&quot;</span><span class="p">,</span>
    <span class="s2">&quot;parallax_error&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pmra&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pmdec&quot;</span><span class="p">,</span>
    <span class="s2">&quot;radial_velocity&quot;</span><span class="p">,</span>
    <span class="s2">&quot;phot_g_mean_mag&quot;</span><span class="p">,</span>
    <span class="s2">&quot;phot_bp_mean_mag&quot;</span><span class="p">,</span>
    <span class="s2">&quot;phot_rp_mean_mag&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">ngc188_table</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;gaia_results.fits&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The above cell may not work if you do not have an internet connection, so we have included the results table along with the notebook:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngc188_table</span> <span class="o">=</span> <span class="n">QTable</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;gaia_results.fits&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">ngc188_table</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4870
</pre></div>
</div>
</div>
</div>
<p>The returned <code class="docutils literal notranslate"><span class="pre">astropy.table</span></code> <code class="docutils literal notranslate"><span class="pre">Table</span></code> object now contains about 5000 stars from <em>Gaia</em> DR2 around the coordinate position of the center of NGC 188. Let’s now construct a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object with the results table. In the <em>Gaia</em> data archive, the ICRS coordinates of a source are given as column names <code class="docutils literal notranslate"><span class="pre">&quot;ra&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;dec&quot;</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngc188_table</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[[11.830258,~11.78143,~11.775831,~\dots,~13.380355,~6.1428143,~15.883725]\mathrm{{}^{\circ}}\]</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngc188_table</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[[85.243627,~85.247148,~85.241932,~\dots,~85.71469,~85.142685,~85.606562]\mathrm{{}^{\circ}}\]</div>
</div>
</div>
<p>Note that, because the <em>Gaia</em> archive provides data tables with associated units, and we read this table using the <code class="docutils literal notranslate"><span class="pre">QTable</span></code> object (<a class="reference external" href="http://docs.astropy.org/en/latest/table/mixin_columns.html#quantity-and-qtable">docs</a>), the above table columns are represented as <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects with units of degrees. Note also that these columns contain many (&gt;5000!) coordinate values. We can pass these directly in to <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> to get a single <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object to represent all of these coordinates:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngc188_gaia_coords</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">ngc188_table</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">],</span> <span class="n">ngc188_table</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">])</span>
<span class="n">ngc188_gaia_coords</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (ICRS): (ra, dec) in deg
    [(11.83025781, 85.24362655), (11.78143038, 85.24714775),
     (11.77583082, 85.24193164), ..., (13.38035513, 85.71468997),
     ( 6.14281433, 85.14268532), (15.88372451, 85.60656188)]&gt;
</pre></div>
</div>
</div>
</div>
<section id="exercises">
<h3>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h3>
<p>Create a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> for the center of the open cluster the Pleiades (either by looking up the coordinates and passing them in, or by using the convenience method we learned about above):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngc188_center</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="o">.</span><span class="n">from_name</span><span class="p">(</span><span class="s2">&quot;NGC 188&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Using only a single method/function call on the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object representing the center of NGC 188, print a string with the RA/Dec in the form ‘HH:MM:SS.S DD:MM:SS.S’. Check your answer against <a class="reference external" href="http://simbad.u-strasbg.fr/simbad/">SIMBAD</a>, which will show you sexagesimal coordinates for the object.</p>
<p><sub>(Hint: <code class="docutils literal notranslate"><span class="pre">SkyCoord.to_string()</span></code> might be useful)</sub></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngc188_center</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;hmsdms&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;00:47:14.8 +85:14:42.0&#39;
</pre></div>
</div>
</div>
</div>
<p>Using a single method/function call on the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object containing the results of our <em>Gaia</em> query, compute the angular separation between each resulting star and the coordinates of the cluster center for NGC 188.</p>
<p><sub>(Hint: <code class="docutils literal notranslate"><span class="pre">SkyCoord.separation()</span></code> might be useful)</sub></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngc188_gaia_coords</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">ngc188_center</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[[$0^\circ00{}^\prime07.42471524{}^{\prime\prime}$
 $0^\circ00{}^\prime11.88878937{}^{\prime\prime}$
 $0^\circ00{}^\prime15.38406054{}^{\prime\prime}$ ...
 $0^\circ29{}^\prime08.31723589{}^{\prime\prime}$
 $0^\circ29{}^\prime08.33277052{}^{\prime\prime}$
 $0^\circ29{}^\prime08.79347319{}^{\prime\prime}$]\]</div>
</div>
</div>
</section>
</section>
<section id="more-than-just-sky-positions-including-distance-information-in-skycoord">
<h2>More Than Just Sky Positions: Including Distance Information in <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code><a class="headerlink" href="#more-than-just-sky-positions-including-distance-information-in-skycoord" title="Link to this heading">#</a></h2>
<p>So far, we have used <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> to represent angular sky positions (i.e., <code class="docutils literal notranslate"><span class="pre">ra</span></code> and <code class="docutils literal notranslate"><span class="pre">dec</span></code> only). It is sometimes useful to include distance information with the sky coordinates of a source, thereby specifying the full 3D position of an object. To pass in distance information, <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> accepts the keyword argument “<code class="docutils literal notranslate"><span class="pre">distance</span></code>”. So, if we knew that the distance to NGC 188 is 1.96 kpc, we could also pass in a distance (as a <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> object) using this argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngc188_center_3d</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mf">12.11</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="mf">85.26</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mf">1.96</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>With the table of <em>Gaia</em> data we retrieved above for stars around NGC 188, <code class="docutils literal notranslate"><span class="pre">ngc188_table</span></code>, we also have parallax measurements for each star. For a precisely-measured parallax <span class="math notranslate nohighlight">\(\varpi\)</span>, the distance <span class="math notranslate nohighlight">\(d\)</span> to a star can be obtained approximately as <span class="math notranslate nohighlight">\(d \approx 1/\varpi\)</span>. This only really works if the parallax error is small relative to the parallax (<a class="reference external" href="https://arxiv.org/abs/1507.02105">see discussion in this paper</a>), so if we want to use these parallaxes to get distances we first have to filter out stars that have low signal-to-noise parallaxes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parallax_snr</span> <span class="o">=</span> <span class="n">ngc188_table</span><span class="p">[</span><span class="s2">&quot;parallax&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">ngc188_table</span><span class="p">[</span><span class="s2">&quot;parallax_error&quot;</span><span class="p">]</span>
<span class="n">ngc188_table_3d</span> <span class="o">=</span> <span class="n">ngc188_table</span><span class="p">[</span><span class="n">parallax_snr</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">]</span>
<span class="nb">len</span><span class="p">(</span><span class="n">ngc188_table_3d</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2423
</pre></div>
</div>
</div>
</div>
<p>The above selection on <code class="docutils literal notranslate"><span class="pre">parallax_snr</span></code> keeps stars that have a ~10-sigma parallax measurement, but this is an arbitrary selection threshold that you may want to tune or remove in your own use cases. This selection removed over half of the stars in our original table, but for the remaining stars we can be confident that converting the parallax measurements to distances is mostly safe.</p>
<p>The default way of passing in a distance to a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object, as above, is to pass in a <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> with a unit of length. However, <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> also provides a specialized object, <code class="docutils literal notranslate"><span class="pre">Distance</span></code>, for handling common transformations of different distance representations (<a class="reference external" href="http://docs.astropy.org/en/latest/coordinates/index.html#distance">docs</a>). Among other things, this class supports passing in a parallax value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Distance</span><span class="p">(</span><span class="n">parallax</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[1000 \; \mathrm{pc}\]</div>
</div>
</div>
<p>The catalog of stars we queried from <em>Gaia</em> contains parallax information in milliarcsecond units, so we can create a <code class="docutils literal notranslate"><span class="pre">Distance</span></code> object directly from these values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gaia_dist</span> <span class="o">=</span> <span class="n">Distance</span><span class="p">(</span><span class="n">parallax</span><span class="o">=</span><span class="n">ngc188_table_3d</span><span class="p">[</span><span class="s2">&quot;parallax&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>We can then create a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object to represent the 3D positions of all of the <em>Gaia</em> stars by passing in this distance object to the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> initializer:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngc188_coords_3d</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span>
    <span class="n">ra</span><span class="o">=</span><span class="n">ngc188_table_3d</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">],</span> <span class="n">dec</span><span class="o">=</span><span class="n">ngc188_table_3d</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">],</span> <span class="n">distance</span><span class="o">=</span><span class="n">gaia_dist</span>
<span class="p">)</span>
<span class="n">ngc188_coords_3d</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (ICRS): (ra, dec, distance) in (deg, deg, pc)
    [(11.83025781, 85.24362655, 2113.23414411),
     (11.77583082, 85.24193164, 1819.25788676),
     (11.79608811, 85.24947769, 1878.68206887), ...,
     (13.38035513, 85.71468997,  820.05330166),
     ( 6.14281433, 85.14268532, 1950.38491004),
     (15.88372451, 85.60656188,  356.47807826)]&gt;
</pre></div>
</div>
</div>
</div>
<p>Let’s now use <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> to plot the sky positions of all of these sources, colored by distance to emphasize the cluster stars:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mf">5.2</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">ngc188_coords_3d</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span>
    <span class="n">ngc188_coords_3d</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="n">ngc188_coords_3d</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">kpc</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;twilight&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
<span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;distance [</span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="si">:</span><span class="s2">latex_inline</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;RA [deg]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Dec [deg]&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Gaia DR2 sources near NGC 188&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Gaia DR2 sources near NGC 188&#39;)
</pre></div>
</div>
<img alt="_images/7c8fdd404491d8e6dc5f2b15fcd38ac97303624131353d6ff5182015fada98c8.png" src="_images/7c8fdd404491d8e6dc5f2b15fcd38ac97303624131353d6ff5182015fada98c8.png" />
</div>
</div>
<p>Now that we have 3D position information for both the cluster center, and for the stars we queried from <em>Gaia</em>, we can compute the 3D separation (distance) between all of the <em>Gaia</em> sources and the cluster center:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sep3d</span> <span class="o">=</span> <span class="n">ngc188_coords_3d</span><span class="o">.</span><span class="n">separation_3d</span><span class="p">(</span><span class="n">ngc188_center_3d</span><span class="p">)</span>
<span class="n">sep3d</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[[153.23746,~140.74633,~81.323346,~\dots,~1139.9932,~19.958413,~1603.5359] \; \mathrm{pc}\]</div>
</div>
</div>
<section id="id1">
<h3>Exercises<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>Using the 3D separation values, define a boolean mask to select candidate members of the cluster. Select all stars within 50 pc of the cluster center. How many candidate members of NGC 188 do we have, based on their 3D positions?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngc188_3d_mask</span> <span class="o">=</span> <span class="n">sep3d</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pc</span>
<span class="n">ngc188_3d_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.int64(262)
</pre></div>
</div>
</div>
</div>
<p>In this tutorial, we have introduced <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> as a way to store and represent astronomical sky coordinates. We used coordinate objects, via the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> class interface, to parse and change coordinate representations and units. We also demonstrated how to use a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object with the <code class="docutils literal notranslate"><span class="pre">astroquery</span></code> package to query an astronomical database, the <em>Gaia</em> science archive. We then created a single <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object with the queried data that represents the sky coordinates of many objects. Finally, we introduced the concept of using <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> to represent a 3D position of an object or set of objects.</p>
</section>
</section>
</section>
<span id="document-2_Coordinates-Transforms"></span><section class="tex2jax_ignore mathjax_ignore" id="astronomical-coordinates-2-transforming-coordinate-systems-and-representations">
<h1>Astronomical Coordinates 2: Transforming Coordinate Systems and Representations<a class="headerlink" href="#astronomical-coordinates-2-transforming-coordinate-systems-and-representations" title="Link to this heading">#</a></h1>
<section id="authors">
<h2>Authors<a class="headerlink" href="#authors" title="Link to this heading">#</a></h2>
<p>Adrian Price-Whelan, Saima Siddiqui, Zihao Chen, Luthien Liu</p>
</section>
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Introduce key concepts in <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code>: coordinate component formats, representations, and frames</p></li>
<li><p>Demonstrate how to work with coordinate representations, for example, to change from Cartesian to Cylindrical coordinates</p></li>
<li><p>Introduce coordinate frame transformations and demonstrate transforming from ICRS coordinates to Galactic and Altitude-Azimuth coordinates</p></li>
</ul>
</section>
<section id="keywords">
<h2>Keywords<a class="headerlink" href="#keywords" title="Link to this heading">#</a></h2>
<p>coordinates, OOP</p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>In the previous tutorial in this series, we showed how astronomical coordinates in the ICRS or equatorial coordinate system can be represented in Python using the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object (<a class="reference external" href="https://docs.astropy.org/en/stable/coordinates/skycoord.html">docs</a>). There are many other coordinate systems that are commonly used in astronomical research. For example, the Galactic coordinate system is often used in radio astronomy and Galactic science, the “horizontal” or altitude-azimuth frame is often used for observatory-specific observation planning, and Ecliptic coordinates are often used for solar system science or space mission footprints. All of these coordinate frames (and others!) are supported by <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code>. As we will see below, the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object is designed to make transforming between these systems a straightforward task.</p>
<p>In this tutorial, we will explore how the <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> package can be used to transform astronomical coordinates between different coordinate systems or frames. You may find it helpful to keep <a class="reference external" href="http://docs.astropy.org/en/stable/coordinates/index.html">the Astropy documentation for the coordinates package</a> open alongside this tutorial for reference or additional reading. In the text below, you may also see some links that look like (<a class="reference external" href="http://docs.astropy.org/en/stable/coordinates/index.html">docs</a>). These links will take you to parts of the documentation that are directly relevant to the cells from which they link.</p>
<p><em>Note: This is the 2nd tutorial in a series of tutorials about astropy.coordinates. If you are new to astropy.coordinates, you may want to start from the beginning or an earlier tutorial.</em></p>
</section>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h2>
<p>We start by importing some general packages that we will need below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">astropy</span><span class="w"> </span><span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.coordinates</span><span class="w"> </span><span class="kn">import</span> <span class="n">SkyCoord</span><span class="p">,</span> <span class="n">Galactic</span><span class="p">,</span> <span class="n">EarthLocation</span><span class="p">,</span> <span class="n">AltAz</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">astropy.coordinates</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">coord</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.time</span><span class="w"> </span><span class="kn">import</span> <span class="n">Time</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="key-astropy-coordinates-concepts-component-formats-representations-and-frames">
<h2>Key <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> Concepts: Component Formats, Representations, and Frames<a class="headerlink" href="#key-astropy-coordinates-concepts-component-formats-representations-and-frames" title="Link to this heading">#</a></h2>
<p>Usage of the term “coordinates” is overloaded in astronomy and is often used interchangeably when referring to data formats (e.g., sexagesimal vs. decimal), representations (e.g., Cartesian vs. spherical), and frames (e.g., equatorial vs. galactic). In <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code>, we have tried to formalize these three concepts and have made them a core part of the way we interact with objects in this subpackage (<a class="reference external" href="https://docs.astropy.org/en/stable/coordinates/index.html#overview-of-astropy-coordinates-concepts">docs</a>). Here we will give an overview of these different concepts as we build up to demonstrating how to transform between different astronomical reference frames or systems.</p>
</section>
<section id="coordinate-component-formats">
<h2>Coordinate Component Formats<a class="headerlink" href="#coordinate-component-formats" title="Link to this heading">#</a></h2>
<p>In our previous tutorial, we showed that it is possible to pass in coordinate component data to the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> initializer as strings or as <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects in a variety of formats and units. We also saw that the coordinate components of <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> objects can be re-formatted. For example, we can change the coordinate <em>format</em> by changing the component units, or converting the data to a string:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="mf">15.9932</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">dec</span><span class="o">=-</span><span class="mf">10.52351344</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">hourangle</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="s2">&quot;hmsdms&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0662133333333335
01h03m58.368s -10d31m24.648384s
-10:31:24.64838
</pre></div>
</div>
</div>
</div>
<p>See the previous tutorial <a class="reference internal" href="#document-1_Coordinates-Intro"><span class="doc std std-doc">Astronomical Coordinates 1 - Getting Started</span></a> for more examples of this.</p>
</section>
<section id="coordinate-representations">
<h2>Coordinate Representations<a class="headerlink" href="#coordinate-representations" title="Link to this heading">#</a></h2>
<p>In the previous tutorial, we only worked with coordinate data in spherical representations (longitude/latitude), but <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> also supports other coordinate representations like Cartesian, cylindrical, etc. (<a class="reference external" href="https://docs.astropy.org/en/stable/coordinates/skycoord.html#astropy-skycoord-representations">docs</a>). To retrieve the coordinate data in a different representation, we can use the <code class="docutils literal notranslate"><span class="pre">SkyCoord.represent_as()</span></code> method. This method either takes a string name of the desired representation, for example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">represent_as</span><span class="p">(</span><span class="s2">&quot;cartesian&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;CartesianRepresentation (x, y, z) [dimensionless]
    (0.94512547, 0.27088898, -0.18263903)&gt;
</pre></div>
</div>
</div>
</div>
<p>or it accepts an <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> <code class="docutils literal notranslate"><span class="pre">Representation</span></code> class, such as:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">represent_as</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">CartesianRepresentation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;CartesianRepresentation (x, y, z) [dimensionless]
    (0.94512547, 0.27088898, -0.18263903)&gt;
</pre></div>
</div>
</div>
</div>
<p>A list of all supported representations is given in the documentation (<a class="reference external" href="https://docs.astropy.org/en/stable/coordinates/representations.html#astropy-coordinates-representations">docs</a>), or can be identified as class names that end in <code class="docutils literal notranslate"><span class="pre">Representaton</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;Representation&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Base&quot;</span><span class="p">)]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;CartesianRepresentation&#39;, &#39;CylindricalRepresentation&#39;, &#39;GRS80GeodeticRepresentation&#39;, &#39;PhysicsSphericalRepresentation&#39;, &#39;RadialRepresentation&#39;, &#39;SphericalRepresentation&#39;, &#39;UnitSphericalRepresentation&#39;, &#39;WGS72GeodeticRepresentation&#39;, &#39;WGS84GeodeticRepresentation&#39;]
</pre></div>
</div>
</div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object that we defined above, we only specified sky positions (i.e., no distance data), so the units of the Cartesian components that are returned above are dimensionless and are interpreted as being on the surface of the (dimensionless) unit sphere. If we instead pass in a distance to <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> using the <code class="docutils literal notranslate"><span class="pre">distance</span></code> keyword argument, we instead get a <code class="docutils literal notranslate"><span class="pre">CartesianRepresentation</span></code> object for the 3D position with positional units. For example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c2</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="mf">15.9932</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">dec</span><span class="o">=-</span><span class="mf">10.52351344</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mf">127.4</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c2</span><span class="o">.</span><span class="n">represent_as</span><span class="p">(</span><span class="s2">&quot;cartesian&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;CartesianRepresentation (x, y, z) in pc
    (120.40898448, 34.5112558, -23.2682118)&gt;
</pre></div>
</div>
</div>
</div>
<p>Or, we could represent this data with cylindrical components:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c2</span><span class="o">.</span><span class="n">represent_as</span><span class="p">(</span><span class="s2">&quot;cylindrical&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;CylindricalRepresentation (rho, phi, z) in (pc, rad, pc)
    (125.2571368, 0.279134, -23.2682118)&gt;
</pre></div>
</div>
</div>
</div>
<p>To summarize, using <code class="docutils literal notranslate"><span class="pre">SkyCoord.represent_as()</span></code> is a convenient way to retrieve your coordinate data in a different representation, like Cartesian or Cylindrical. You can also change (in place) the representation of a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object by setting the <code class="docutils literal notranslate"><span class="pre">SkyCoord.representation_type</span></code> attribute. For example, if we create a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> again with a distance, the default representation type is spherical:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c3</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="mf">15.9932</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">dec</span><span class="o">=-</span><span class="mf">10.52351344</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mf">127.4</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">c3</span><span class="o">.</span><span class="n">representation_type</span><span class="p">)</span>
<span class="n">c3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;astropy.coordinates.representation.spherical.SphericalRepresentation&#39;&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (ICRS): (ra, dec, distance) in (deg, deg, pc)
    (15.9932, -10.52351344, 127.4)&gt;
</pre></div>
</div>
</div>
</div>
<p>We can, however, change the internal representation of the data by setting the <code class="docutils literal notranslate"><span class="pre">representation_type</span></code> attribute to a new <code class="docutils literal notranslate"><span class="pre">Representation</span></code> class:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c3</span><span class="o">.</span><span class="n">representation_type</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">CylindricalRepresentation</span>
</pre></div>
</div>
</div>
</div>
<p>This then changes the way <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> will display the components:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (ICRS): (rho, phi, z) in (pc, deg, pc)
    (125.2571368, 15.9932, -23.2682118)&gt;
</pre></div>
</div>
</div>
</div>
<p>Note, however, that changing the representation will also change the components that are available on a given <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object: Once we set the <code class="docutils literal notranslate"><span class="pre">representation_type</span></code> to cylindrical, the attributes <code class="docutils literal notranslate"><span class="pre">.ra</span></code> and <code class="docutils literal notranslate"><span class="pre">.dec</span></code> will no longer work, and we instead have to use the cylindrical component names to access the data. In this case, these are <code class="docutils literal notranslate"><span class="pre">.rho</span></code> for radius, <code class="docutils literal notranslate"><span class="pre">.phi</span></code> for azimuth, <code class="docutils literal notranslate"><span class="pre">.z</span></code> for <span class="math notranslate nohighlight">\(z\)</span> position:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c3</span><span class="o">.</span><span class="n">rho</span><span class="p">,</span> <span class="n">c3</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span> <span class="n">c3</span><span class="o">.</span><span class="n">z</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Quantity 125.2571368 pc&gt;, &lt;Angle 15.9932 deg&gt;, &lt;Quantity -23.2682118 pc&gt;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="transforming-between-coordinate-frames">
<h2>Transforming Between Coordinate Frames<a class="headerlink" href="#transforming-between-coordinate-frames" title="Link to this heading">#</a></h2>
<p>The third key concept to keep in mind when thinking about astronomical coordinate data is the reference frame or coordinate system that the data are in. In the previous tutorial, and so far here, we have worked with the default frame assumed by <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code>: the International Celestial Reference System (ICRS; <a class="reference external" href="https://arxiv.org/abs/astro-ph/0602086">some important definitions and context about the ICRS is given here</a>). The ICRS is the fundamental coordinate system used in most modern astronomical contexts and is generally what people mean when they refer to “equatorial” or “J2000” or “RA/Dec” coordinates (but there are some important caveats if you are working with older data). As noted above, however, there are many other coordinate systems used in different astronomical, solar, or solar system contexts.</p>
<p>Some other common coordinate systems are defined as a rotation away from the ICRS that is defined to make science applications easier to interpret. One example here is the Galactic coordinate system, which is rotated with respect to the ICRS to approximately align the Galactic plane with latitude=0. As an example of the <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> frame transformation machinery, we will load in a subset of a catalog of positions and distances to a set of open clusters in the Milky Way from Cantat-Gaudin et al. 2018 (<a class="reference external" href="http://vizier.u-strasbg.fr/viz-bin/VizieR-3?-source=J/A%2bA/618/A93/table1">Table 1 in this catalog</a>). We have pre-selected the 474 clusters within 2 kpc of the sun and provide the catalog as a data file next to this notebook. This catalog provides sky position (columns <code class="docutils literal notranslate"><span class="pre">RAJ2000</span></code> and <code class="docutils literal notranslate"><span class="pre">DEJ2000</span></code> in the original catalog) and distance estimates (column <code class="docutils literal notranslate"><span class="pre">dmode</span></code> in the original catalog), which we have renamed in the table we provide to column names <code class="docutils literal notranslate"><span class="pre">'ra'</span></code>, <code class="docutils literal notranslate"><span class="pre">'dec'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'distance'</span></code>. We will start by loading the catalog as a <code class="docutils literal notranslate"><span class="pre">QTable</span></code>  using <code class="docutils literal notranslate"><span class="pre">astropy.table</span></code> (<a class="reference external" href="https://docs.astropy.org/en/stable/table/">docs</a>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tbl</span> <span class="o">=</span> <span class="n">QTable</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;Cantat-Gaudin-open-clusters.ecsv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can now pass the coordinate components to <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> to create a single array-valued <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object to represent the positions of all of the open clusters in this catalog. Note that below we will explicitly specify the coordinate frame using <code class="docutils literal notranslate"><span class="pre">frame='icrs'</span></code>: Even though this is the default frame, it is often better to be explicit so that it is clearer to someone reading the code what the coordinate system is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">open_cluster_c</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span>
    <span class="n">ra</span><span class="o">=</span><span class="n">tbl</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">],</span> <span class="n">dec</span><span class="o">=</span><span class="n">tbl</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">],</span> <span class="n">distance</span><span class="o">=</span><span class="n">tbl</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">],</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span>
<span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">open_cluster_c</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>474
</pre></div>
</div>
</div>
</div>
<p>To see the first few coordinate entries, we can “slice” the array-valued coordinate object like we would a Python list or numpy array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">open_cluster_c</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (ICRS): (ra, dec, distance) in (deg, deg, pc)
    [( 51.87 , 34.981,  629.6), (288.399, 36.369,  382.2),
     (295.548, 27.366,  522.9), (298.306, 39.349, 1034.6)]&gt;
</pre></div>
</div>
</div>
</div>
<p>Let’s now visualize the sky positions of all of these clusters, colored by their distances. To plot these in an all-sky spherical projection (e.g., aitoff) using <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>, with longitude increasing to the left as is typically done for plotting astronomical objects on the sky, we have to trick <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> a little bit: We have to pass in the <em>negative</em> angle values when plotting, then reformat the tick labels to make them positive values again. We have written a short function below to handle this trick:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">coordinates_aitoff_plot</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s2">&quot;aitoff&quot;</span><span class="p">))</span>

    <span class="n">sph</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">spherical</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="o">-</span><span class="n">sph</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">wrap_at</span><span class="p">(</span><span class="mi">180</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span><span class="o">.</span><span class="n">radian</span><span class="p">,</span> <span class="n">sph</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">radian</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">sph</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">value</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fmt_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">radian</span><span class="p">)</span><span class="o">.</span><span class="n">wrap_at</span><span class="p">(</span><span class="mi">360</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span><span class="o">.</span><span class="n">degree</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">val</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;^{\circ}$&quot;</span>

    <span class="n">ticker</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="n">fmt_func</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

    <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
    <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;distance [pc]&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can plot the sky positions by passing our <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object in to this <code class="docutils literal notranslate"><span class="pre">coordinates_aitoff_plot()</span></code> plot helper function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">coordinates_aitoff_plot</span><span class="p">(</span><span class="n">open_cluster_c</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;RA [deg]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Dec [deg]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Dec [deg]&#39;)
</pre></div>
</div>
<img alt="_images/4bcd91bba193587ea889c7d17402bb8c7e1cc28ff2b98c2c20813ee082f41784.png" src="_images/4bcd91bba193587ea889c7d17402bb8c7e1cc28ff2b98c2c20813ee082f41784.png" />
</div>
</div>
<p>The majority of these open clusters are relatively close to the Galactic midplane, which is why they form a fairly narrow “band” on the sky in ICRS coordinates. If we transform these positions to Galactic coordinates, we would therefore expect the points to appear around the latitude <span class="math notranslate nohighlight">\(b=0\)</span> line.</p>
<p>To transform our coordinates from ICRS to Galactic (or any other coordinate system), we can use the <code class="docutils literal notranslate"><span class="pre">SkyCoord.transform_to()</span></code> method and pass in the new coordinate frame instance (in this case, <code class="docutils literal notranslate"><span class="pre">Galactic()</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">open_cluster_gal</span> <span class="o">=</span> <span class="n">open_cluster_c</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">Galactic</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>While the recommended way of transforming <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> objects to new frames is by passing in a frame class <em>instance</em> as we demonstrated in the cell above, <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> also supports a shorthand for transforming some frames by accessing attributes (named as the lower-case version of the new frame name):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">open_cluster_gal</span> <span class="o">=</span> <span class="n">open_cluster_c</span><span class="o">.</span><span class="n">galactic</span>
</pre></div>
</div>
</div>
</div>
<p>The transformed <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object now contains coordinate data in the <code class="docutils literal notranslate"><span class="pre">Galactic</span></code> coordinate frame:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">open_cluster_gal</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (Galactic): (l, b, distance) in (deg, deg, pc)
    [(155.72353157, -17.76999215,  629.59997559),
     ( 68.02807936,  11.60790067,  382.20001221),
     ( 62.82445527,   2.06275608,  522.90002441),
     ( 74.37841053,   6.07393592, 1034.59997559)]&gt;
</pre></div>
</div>
</div>
</div>
<p>Comparing this to the original <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code>, note that the names of the longitude and latitude components have changed from <code class="docutils literal notranslate"><span class="pre">ra</span></code> to <code class="docutils literal notranslate"><span class="pre">l</span></code> and from <code class="docutils literal notranslate"><span class="pre">dec</span></code> to <code class="docutils literal notranslate"><span class="pre">b</span></code>, per convention. We can therefore access the new Galactic longitude/latitude data using these new attribute names:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">open_cluster_gal</span><span class="o">.</span><span class="n">l</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[[$155^\circ43{}^\prime24.71365331{}^{\prime\prime}$
 $68^\circ01{}^\prime41.08568525{}^{\prime\prime}$
 $62^\circ49{}^\prime28.03898608{}^{\prime\prime}$]\]</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">open_cluster_gal</span><span class="o">.</span><span class="n">b</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[[$-17^\circ46{}^\prime11.97173095{}^{\prime\prime}$
 $11^\circ36{}^\prime28.44242147{}^{\prime\prime}$
 $2^\circ03{}^\prime45.92187936{}^{\prime\prime}$]\]</div>
</div>
</div>
<p><em>Note: the ICRS coordinate component names (<code class="docutils literal notranslate"><span class="pre">.ra</span></code>, <code class="docutils literal notranslate"><span class="pre">.dec</span></code>) will therefore <strong>not</strong> work on this new, transformed <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> instance, <code class="docutils literal notranslate"><span class="pre">open_cluster_gal</span></code></em></p>
<p>With this new <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object (in the Galactic frame), let’s re-make a sky plot to visualize the sky positions of the open clusters in Galactic coordinates:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">coordinates_aitoff_plot</span><span class="p">(</span><span class="n">open_cluster_gal</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Galactic longitude, $l$ [deg]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Galactic latitude, $b$ [deg]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Galactic latitude, $b$ [deg]&#39;)
</pre></div>
</div>
<img alt="_images/e27dec4cbe9ebbafa85d7b7db57d3ec47b337dd44a82550f2c84b18a5a676ac9.png" src="_images/e27dec4cbe9ebbafa85d7b7db57d3ec47b337dd44a82550f2c84b18a5a676ac9.png" />
</div>
</div>
<p>As we hoped and expected, in the Galactic coordinate frame, the open clusters predominantly appear at low galactic latitudes!</p>
</section>
<section id="transforming-to-more-complex-coordinate-frames-computing-the-altitude-of-a-target-at-an-observatory">
<h2>Transforming to More Complex Coordinate Frames: Computing the Altitude of a Target at an Observatory<a class="headerlink" href="#transforming-to-more-complex-coordinate-frames-computing-the-altitude-of-a-target-at-an-observatory" title="Link to this heading">#</a></h2>
<p>To determine whether a target is observable from a given observatory on Earth or to find out what targets are observable from a city or place on Earth at some time, we sometimes need to convert a coordinate or set of coordinates to a frame that is local to an on-earth observer. The most common choice for such a frame is “horizontal” or “Altitude-Azimuth” coordinates. In this frame, the sky coordinates of a source can be specified as an altitude from the horizon and an azimuth angle at a specified time. This coordinate frame is supported in <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> through the <code class="docutils literal notranslate"><span class="pre">AltAz</span></code> coordinate frame.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">AltAz</span></code> frame is different from the previously-demonstrated <code class="docutils literal notranslate"><span class="pre">Galactic</span></code> frame in that it requires additional metadata to define the frame instance. Since the <code class="docutils literal notranslate"><span class="pre">Galactic</span></code> frame is close to being a 3D rotation away from the ICRS frame, and that rotation matrix is fixed, we could transform to <code class="docutils literal notranslate"><span class="pre">Galactic</span></code> by instantiating the class with no arguments (see the example above where we used <code class="docutils literal notranslate"><span class="pre">.transform_to(Galactic())</span></code>). In order to specify an instance of the <code class="docutils literal notranslate"><span class="pre">AltAz</span></code> frame, we have to (at minimum) pass in (1) a location on Earth, and (2) the time (or times) we are requesting the frame at.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code>, we specify locations on Earth with the <code class="docutils literal notranslate"><span class="pre">EarthLocation</span></code> class (<a class="reference external" href="https://docs.astropy.org/en/stable/api/astropy.coordinates.EarthLocation.html">docs</a>). If we know the Earth longitude and latitude of our site, we can use these to create an instance of <code class="docutils literal notranslate"><span class="pre">EarthLocation</span></code> directly:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_loc</span> <span class="o">=</span> <span class="n">EarthLocation</span><span class="o">.</span><span class="n">from_geodetic</span><span class="p">(</span><span class="n">lon</span><span class="o">=-</span><span class="mf">74.32834</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mf">43.05885</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">EarthLocation</span></code> class also provides handy short-hands for retrieving an instance for a given street address (by querying the <a class="reference external" href="https://www.openstreetmap.org/">OpenStreetMap</a> web API):</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_loc</span> <span class="o">=</span> <span class="n">EarthLocation</span><span class="o">.</span><span class="n">of_address</span><span class="p">(</span><span class="s2">&quot;162 Fifth Ave, New York, NY 10010&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Or for an astronomical observatory (use <code class="docutils literal notranslate"><span class="pre">EarthLocation.get_site_names()</span></code> to see a list of all available sites). For example, to retrieve an <code class="docutils literal notranslate"><span class="pre">EarthLocation</span></code> instance for the position of Kitt Peak National Observatory (in AZ, USA):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">observing_location</span> <span class="o">=</span> <span class="n">EarthLocation</span><span class="o">.</span><span class="n">of_site</span><span class="p">(</span><span class="s2">&quot;Kitt Peak&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We will use Kitt Peak as our site.</p>
<p>As an example, we will now compute the altitude of a few of the open clusters from our catalog above over the course of a night. We have an object to represent our location on Earth, so now we need to create a set of times to compute the <code class="docutils literal notranslate"><span class="pre">AltAz</span></code> frame for. <code class="docutils literal notranslate"><span class="pre">AltAz</span></code> expects time information to be passed in as an <code class="docutils literal notranslate"><span class="pre">astropy.time.Time</span></code> object (<a class="reference external" href="https://docs.astropy.org/en/stable/api/astropy.time.Time.html">docs</a>; which can contain an array of times). Let’s pretend we have an observing run coming up on Dec 18, 2020, and we would like to compute the altitude/azimuth coordinates for our open clusters over that whole night.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1AM UTC = 6PM local time (AZ mountain time), roughly the start of a night</span>
<span class="n">observing_date</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2020-12-18 1:00&quot;</span><span class="p">)</span>

<span class="c1"># Compute the alt/az over a 14 hour period, starting at 6PM local time,</span>
<span class="c1"># with 256 equally spaced time points:</span>
<span class="n">time_grid</span> <span class="o">=</span> <span class="n">observing_date</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">hour</span>
</pre></div>
</div>
</div>
</div>
<p>Now we use our location, <code class="docutils literal notranslate"><span class="pre">observing_location</span></code>, and this grid of times, <code class="docutils literal notranslate"><span class="pre">time_grid</span></code>, to create an <code class="docutils literal notranslate"><span class="pre">AltAz</span></code> frame object.</p>
<p><em>Note: This frame accepts even more parameters about the atmosphere, which can be used to correct for atmospheric refraction. But here we leave those additional parameters set to their defaults, which ignores refraction.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">altaz</span> <span class="o">=</span> <span class="n">AltAz</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">observing_location</span><span class="p">,</span> <span class="n">obstime</span><span class="o">=</span><span class="n">time_grid</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can transform the ICRS <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> positions of the open clusters to <code class="docutils literal notranslate"><span class="pre">AltAz</span></code> to get the location of each of the clusters in the sky over Kitt Peak over a night. Let’s first do this only for the first open cluster in the catalog we loaded:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">oc_altaz</span> <span class="o">=</span> <span class="n">open_cluster_c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">altaz</span><span class="p">)</span>
<span class="n">oc_altaz</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (AltAz: obstime=[&#39;2020-12-18 01:00:00.000&#39; &#39;2020-12-18 01:03:17.647&#39;
 &#39;2020-12-18 01:06:35.294&#39; &#39;2020-12-18 01:09:52.941&#39;
 &#39;2020-12-18 01:13:10.588&#39; &#39;2020-12-18 01:16:28.235&#39;
 &#39;2020-12-18 01:19:45.882&#39; &#39;2020-12-18 01:23:03.529&#39;
 &#39;2020-12-18 01:26:21.176&#39; &#39;2020-12-18 01:29:38.824&#39;
 &#39;2020-12-18 01:32:56.471&#39; &#39;2020-12-18 01:36:14.118&#39;
 &#39;2020-12-18 01:39:31.765&#39; &#39;2020-12-18 01:42:49.412&#39;
 &#39;2020-12-18 01:46:07.059&#39; &#39;2020-12-18 01:49:24.706&#39;
 &#39;2020-12-18 01:52:42.353&#39; &#39;2020-12-18 01:56:00.000&#39;
 &#39;2020-12-18 01:59:17.647&#39; &#39;2020-12-18 02:02:35.294&#39;
 &#39;2020-12-18 02:05:52.941&#39; &#39;2020-12-18 02:09:10.588&#39;
 &#39;2020-12-18 02:12:28.235&#39; &#39;2020-12-18 02:15:45.882&#39;
 &#39;2020-12-18 02:19:03.529&#39; &#39;2020-12-18 02:22:21.176&#39;
 &#39;2020-12-18 02:25:38.824&#39; &#39;2020-12-18 02:28:56.471&#39;
 &#39;2020-12-18 02:32:14.118&#39; &#39;2020-12-18 02:35:31.765&#39;
 &#39;2020-12-18 02:38:49.412&#39; &#39;2020-12-18 02:42:07.059&#39;
 &#39;2020-12-18 02:45:24.706&#39; &#39;2020-12-18 02:48:42.353&#39;
 &#39;2020-12-18 02:52:00.000&#39; &#39;2020-12-18 02:55:17.647&#39;
 &#39;2020-12-18 02:58:35.294&#39; &#39;2020-12-18 03:01:52.941&#39;
 &#39;2020-12-18 03:05:10.588&#39; &#39;2020-12-18 03:08:28.235&#39;
 &#39;2020-12-18 03:11:45.882&#39; &#39;2020-12-18 03:15:03.529&#39;
 &#39;2020-12-18 03:18:21.176&#39; &#39;2020-12-18 03:21:38.824&#39;
 &#39;2020-12-18 03:24:56.471&#39; &#39;2020-12-18 03:28:14.118&#39;
 &#39;2020-12-18 03:31:31.765&#39; &#39;2020-12-18 03:34:49.412&#39;
 &#39;2020-12-18 03:38:07.059&#39; &#39;2020-12-18 03:41:24.706&#39;
 &#39;2020-12-18 03:44:42.353&#39; &#39;2020-12-18 03:48:00.000&#39;
 &#39;2020-12-18 03:51:17.647&#39; &#39;2020-12-18 03:54:35.294&#39;
 &#39;2020-12-18 03:57:52.941&#39; &#39;2020-12-18 04:01:10.588&#39;
 &#39;2020-12-18 04:04:28.235&#39; &#39;2020-12-18 04:07:45.882&#39;
 &#39;2020-12-18 04:11:03.529&#39; &#39;2020-12-18 04:14:21.176&#39;
 &#39;2020-12-18 04:17:38.824&#39; &#39;2020-12-18 04:20:56.471&#39;
 &#39;2020-12-18 04:24:14.118&#39; &#39;2020-12-18 04:27:31.765&#39;
 &#39;2020-12-18 04:30:49.412&#39; &#39;2020-12-18 04:34:07.059&#39;
 &#39;2020-12-18 04:37:24.706&#39; &#39;2020-12-18 04:40:42.353&#39;
 &#39;2020-12-18 04:44:00.000&#39; &#39;2020-12-18 04:47:17.647&#39;
 &#39;2020-12-18 04:50:35.294&#39; &#39;2020-12-18 04:53:52.941&#39;
 &#39;2020-12-18 04:57:10.588&#39; &#39;2020-12-18 05:00:28.235&#39;
 &#39;2020-12-18 05:03:45.882&#39; &#39;2020-12-18 05:07:03.529&#39;
 &#39;2020-12-18 05:10:21.176&#39; &#39;2020-12-18 05:13:38.824&#39;
 &#39;2020-12-18 05:16:56.471&#39; &#39;2020-12-18 05:20:14.118&#39;
 &#39;2020-12-18 05:23:31.765&#39; &#39;2020-12-18 05:26:49.412&#39;
 &#39;2020-12-18 05:30:07.059&#39; &#39;2020-12-18 05:33:24.706&#39;
 &#39;2020-12-18 05:36:42.353&#39; &#39;2020-12-18 05:40:00.000&#39;
 &#39;2020-12-18 05:43:17.647&#39; &#39;2020-12-18 05:46:35.294&#39;
 &#39;2020-12-18 05:49:52.941&#39; &#39;2020-12-18 05:53:10.588&#39;
 &#39;2020-12-18 05:56:28.235&#39; &#39;2020-12-18 05:59:45.882&#39;
 &#39;2020-12-18 06:03:03.529&#39; &#39;2020-12-18 06:06:21.176&#39;
 &#39;2020-12-18 06:09:38.824&#39; &#39;2020-12-18 06:12:56.471&#39;
 &#39;2020-12-18 06:16:14.118&#39; &#39;2020-12-18 06:19:31.765&#39;
 &#39;2020-12-18 06:22:49.412&#39; &#39;2020-12-18 06:26:07.059&#39;
 &#39;2020-12-18 06:29:24.706&#39; &#39;2020-12-18 06:32:42.353&#39;
 &#39;2020-12-18 06:36:00.000&#39; &#39;2020-12-18 06:39:17.647&#39;
 &#39;2020-12-18 06:42:35.294&#39; &#39;2020-12-18 06:45:52.941&#39;
 &#39;2020-12-18 06:49:10.588&#39; &#39;2020-12-18 06:52:28.235&#39;
 &#39;2020-12-18 06:55:45.882&#39; &#39;2020-12-18 06:59:03.529&#39;
 &#39;2020-12-18 07:02:21.176&#39; &#39;2020-12-18 07:05:38.824&#39;
 &#39;2020-12-18 07:08:56.471&#39; &#39;2020-12-18 07:12:14.118&#39;
 &#39;2020-12-18 07:15:31.765&#39; &#39;2020-12-18 07:18:49.412&#39;
 &#39;2020-12-18 07:22:07.059&#39; &#39;2020-12-18 07:25:24.706&#39;
 &#39;2020-12-18 07:28:42.353&#39; &#39;2020-12-18 07:32:00.000&#39;
 &#39;2020-12-18 07:35:17.647&#39; &#39;2020-12-18 07:38:35.294&#39;
 &#39;2020-12-18 07:41:52.941&#39; &#39;2020-12-18 07:45:10.588&#39;
 &#39;2020-12-18 07:48:28.235&#39; &#39;2020-12-18 07:51:45.882&#39;
 &#39;2020-12-18 07:55:03.529&#39; &#39;2020-12-18 07:58:21.176&#39;
 &#39;2020-12-18 08:01:38.824&#39; &#39;2020-12-18 08:04:56.471&#39;
 &#39;2020-12-18 08:08:14.118&#39; &#39;2020-12-18 08:11:31.765&#39;
 &#39;2020-12-18 08:14:49.412&#39; &#39;2020-12-18 08:18:07.059&#39;
 &#39;2020-12-18 08:21:24.706&#39; &#39;2020-12-18 08:24:42.353&#39;
 &#39;2020-12-18 08:28:00.000&#39; &#39;2020-12-18 08:31:17.647&#39;
 &#39;2020-12-18 08:34:35.294&#39; &#39;2020-12-18 08:37:52.941&#39;
 &#39;2020-12-18 08:41:10.588&#39; &#39;2020-12-18 08:44:28.235&#39;
 &#39;2020-12-18 08:47:45.882&#39; &#39;2020-12-18 08:51:03.529&#39;
 &#39;2020-12-18 08:54:21.176&#39; &#39;2020-12-18 08:57:38.824&#39;
 &#39;2020-12-18 09:00:56.471&#39; &#39;2020-12-18 09:04:14.118&#39;
 &#39;2020-12-18 09:07:31.765&#39; &#39;2020-12-18 09:10:49.412&#39;
 &#39;2020-12-18 09:14:07.059&#39; &#39;2020-12-18 09:17:24.706&#39;
 &#39;2020-12-18 09:20:42.353&#39; &#39;2020-12-18 09:24:00.000&#39;
 &#39;2020-12-18 09:27:17.647&#39; &#39;2020-12-18 09:30:35.294&#39;
 &#39;2020-12-18 09:33:52.941&#39; &#39;2020-12-18 09:37:10.588&#39;
 &#39;2020-12-18 09:40:28.235&#39; &#39;2020-12-18 09:43:45.882&#39;
 &#39;2020-12-18 09:47:03.529&#39; &#39;2020-12-18 09:50:21.176&#39;
 &#39;2020-12-18 09:53:38.824&#39; &#39;2020-12-18 09:56:56.471&#39;
 &#39;2020-12-18 10:00:14.118&#39; &#39;2020-12-18 10:03:31.765&#39;
 &#39;2020-12-18 10:06:49.412&#39; &#39;2020-12-18 10:10:07.059&#39;
 &#39;2020-12-18 10:13:24.706&#39; &#39;2020-12-18 10:16:42.353&#39;
 &#39;2020-12-18 10:20:00.000&#39; &#39;2020-12-18 10:23:17.647&#39;
 &#39;2020-12-18 10:26:35.294&#39; &#39;2020-12-18 10:29:52.941&#39;
 &#39;2020-12-18 10:33:10.588&#39; &#39;2020-12-18 10:36:28.235&#39;
 &#39;2020-12-18 10:39:45.882&#39; &#39;2020-12-18 10:43:03.529&#39;
 &#39;2020-12-18 10:46:21.176&#39; &#39;2020-12-18 10:49:38.824&#39;
 &#39;2020-12-18 10:52:56.471&#39; &#39;2020-12-18 10:56:14.118&#39;
 &#39;2020-12-18 10:59:31.765&#39; &#39;2020-12-18 11:02:49.412&#39;
 &#39;2020-12-18 11:06:07.059&#39; &#39;2020-12-18 11:09:24.706&#39;
 &#39;2020-12-18 11:12:42.353&#39; &#39;2020-12-18 11:16:00.000&#39;
 &#39;2020-12-18 11:19:17.647&#39; &#39;2020-12-18 11:22:35.294&#39;
 &#39;2020-12-18 11:25:52.941&#39; &#39;2020-12-18 11:29:10.588&#39;
 &#39;2020-12-18 11:32:28.235&#39; &#39;2020-12-18 11:35:45.882&#39;
 &#39;2020-12-18 11:39:03.529&#39; &#39;2020-12-18 11:42:21.176&#39;
 &#39;2020-12-18 11:45:38.824&#39; &#39;2020-12-18 11:48:56.471&#39;
 &#39;2020-12-18 11:52:14.118&#39; &#39;2020-12-18 11:55:31.765&#39;
 &#39;2020-12-18 11:58:49.412&#39; &#39;2020-12-18 12:02:07.059&#39;
 &#39;2020-12-18 12:05:24.706&#39; &#39;2020-12-18 12:08:42.353&#39;
 &#39;2020-12-18 12:12:00.000&#39; &#39;2020-12-18 12:15:17.647&#39;
 &#39;2020-12-18 12:18:35.294&#39; &#39;2020-12-18 12:21:52.941&#39;
 &#39;2020-12-18 12:25:10.588&#39; &#39;2020-12-18 12:28:28.235&#39;
 &#39;2020-12-18 12:31:45.882&#39; &#39;2020-12-18 12:35:03.529&#39;
 &#39;2020-12-18 12:38:21.176&#39; &#39;2020-12-18 12:41:38.824&#39;
 &#39;2020-12-18 12:44:56.471&#39; &#39;2020-12-18 12:48:14.118&#39;
 &#39;2020-12-18 12:51:31.765&#39; &#39;2020-12-18 12:54:49.412&#39;
 &#39;2020-12-18 12:58:07.059&#39; &#39;2020-12-18 13:01:24.706&#39;
 &#39;2020-12-18 13:04:42.353&#39; &#39;2020-12-18 13:08:00.000&#39;
 &#39;2020-12-18 13:11:17.647&#39; &#39;2020-12-18 13:14:35.294&#39;
 &#39;2020-12-18 13:17:52.941&#39; &#39;2020-12-18 13:21:10.588&#39;
 &#39;2020-12-18 13:24:28.235&#39; &#39;2020-12-18 13:27:45.882&#39;
 &#39;2020-12-18 13:31:03.529&#39; &#39;2020-12-18 13:34:21.176&#39;
 &#39;2020-12-18 13:37:38.824&#39; &#39;2020-12-18 13:40:56.471&#39;
 &#39;2020-12-18 13:44:14.118&#39; &#39;2020-12-18 13:47:31.765&#39;
 &#39;2020-12-18 13:50:49.412&#39; &#39;2020-12-18 13:54:07.059&#39;
 &#39;2020-12-18 13:57:24.706&#39; &#39;2020-12-18 14:00:42.353&#39;
 &#39;2020-12-18 14:04:00.000&#39; &#39;2020-12-18 14:07:17.647&#39;
 &#39;2020-12-18 14:10:35.294&#39; &#39;2020-12-18 14:13:52.941&#39;
 &#39;2020-12-18 14:17:10.588&#39; &#39;2020-12-18 14:20:28.235&#39;
 &#39;2020-12-18 14:23:45.882&#39; &#39;2020-12-18 14:27:03.529&#39;
 &#39;2020-12-18 14:30:21.176&#39; &#39;2020-12-18 14:33:38.824&#39;
 &#39;2020-12-18 14:36:56.471&#39; &#39;2020-12-18 14:40:14.118&#39;
 &#39;2020-12-18 14:43:31.765&#39; &#39;2020-12-18 14:46:49.412&#39;
 &#39;2020-12-18 14:50:07.059&#39; &#39;2020-12-18 14:53:24.706&#39;
 &#39;2020-12-18 14:56:42.353&#39; &#39;2020-12-18 15:00:00.000&#39;], location=(-1994502.604306139, -5037538.54232911, 3358104.9969029757) m, pressure=0.0 hPa, temperature=0.0 deg_C, relative_humidity=0.0, obswl=1.0 micron): (az, alt, distance) in (deg, deg, pc)
    [( 68.6453125 ,  3.92957964e+01, 629.59997152),
     ( 68.87232312,  3.99487849e+01, 629.59997152),
     ( 69.09658831,  4.06027679e+01, 629.59997152),
     ( 69.31808233,  4.12577232e+01, 629.59997152),
     ( 69.53677613,  4.19136292e+01, 629.59997152),
     ( 69.75263715,  4.25704639e+01, 629.59997152),
     ( 69.9656291 ,  4.32282062e+01, 629.59997152),
     ( 70.17571173,  4.38868345e+01, 629.59997152),
     ( 70.38284052,  4.45463280e+01, 629.59997152),
     ( 70.58696641,  4.52066657e+01, 629.59997152),
     ( 70.7880355 ,  4.58678268e+01, 629.59997152),
     ( 70.98598866,  4.65297907e+01, 629.59997152),
     ( 71.18076119,  4.71925370e+01, 629.59997152),
     ( 71.37228235,  4.78560452e+01, 629.59997152),
     ( 71.56047493,  4.85202949e+01, 629.59997152),
     ( 71.74525474,  4.91852660e+01, 629.59997152),
     ( 71.92653004,  4.98509381e+01, 629.59997152),
     ( 72.10420091,  5.05172912e+01, 629.59997152),
     ( 72.2781586 ,  5.11843049e+01, 629.59997152),
     ( 72.44828473,  5.18519591e+01, 629.59997152),
     ( 72.61445048,  5.25202334e+01, 629.59997152),
     ( 72.77651565,  5.31891073e+01, 629.59997152),
     ( 72.9343276 ,  5.38585605e+01, 629.59997152),
     ( 73.08772013,  5.45285720e+01, 629.59997152),
     ( 73.23651217,  5.51991212e+01, 629.59997152),
     ( 73.38050632,  5.58701867e+01, 629.59997152),
     ( 73.51948725,  5.65417471e+01, 629.59997152),
     ( 73.65321987,  5.72137807e+01, 629.59997152),
     ( 73.78144728,  5.78862651e+01, 629.59997152),
     ( 73.90388843,  5.85591777e+01, 629.59997152),
     ( 74.02023555,  5.92324952e+01, 629.59997152),
     ( 74.13015113,  5.99061937e+01, 629.59997152),
     ( 74.23326456,  6.05802484e+01, 629.59997152),
     ( 74.32916826,  6.12546340e+01, 629.59997152),
     ( 74.4174133 ,  6.19293238e+01, 629.59997152),
     ( 74.4975043 ,  6.26042903e+01, 629.59997152),
     ( 74.56889364,  6.32795045e+01, 629.59997152),
     ( 74.63097474,  6.39549360e+01, 629.59997152),
     ( 74.68307425,  6.46305528e+01, 629.59997152),
     ( 74.72444303,  6.53063208e+01, 629.59997152),
     ( 74.75424559,  6.59822037e+01, 629.59997152),
     ( 74.77154774,  6.66581626e+01, 629.59997152),
     ( 74.775302  ,  6.73341557e+01, 629.59997152),
     ( 74.7643305 ,  6.80101374e+01, 629.59997152),
     ( 74.73730454,  6.86860586e+01, 629.59997152),
     ( 74.69272033,  6.93618648e+01, 629.59997152),
     ( 74.62886986,  7.00374965e+01, 629.59997152),
     ( 74.54380585,  7.07128874e+01, 629.59997152),
     ( 74.43529924,  7.13879634e+01, 629.59997152),
     ( 74.30078745,  7.20626413e+01, 629.59997152),
     ( 74.13731089,  7.27368270e+01, 629.59997152),
     ( 73.94143462,  7.34104128e+01, 629.59997152),
     ( 73.70915091,  7.40832754e+01, 629.59997153),
     ( 73.43575731,  7.47552717e+01, 629.59997153),
     ( 73.11570266,  7.54262347e+01, 629.59997153),
     ( 72.74239115,  7.60959677e+01, 629.59997153),
     ( 72.30793074,  7.67642369e+01, 629.59997153),
     ( 71.80280707,  7.74307620e+01, 629.59997153),
     ( 71.21545687,  7.80952030e+01, 629.59997153),
     ( 70.53170387,  7.87571438e+01, 629.59997153),
     ( 69.73400548,  7.94160683e+01, 629.59997153),
     ( 68.80043555,  8.00713294e+01, 629.59997153),
     ( 67.7032968 ,  8.07221043e+01, 629.59997153),
     ( 66.4072092 ,  8.13673318e+01, 629.59997153),
     ( 64.86645553,  8.20056224e+01, 629.59997153),
     ( 63.02127816,  8.26351262e+01, 629.59997153),
     ( 60.79272411,  8.32533373e+01, 629.59997153),
     ( 58.07557898,  8.38568002e+01, 629.59997153),
     ( 54.72909461,  8.44406656e+01, 629.59997153),
     ( 50.56612067,  8.49980225e+01, 629.59997153),
     ( 45.34425335,  8.55189269e+01, 629.59997153),
     ( 38.77063621,  8.59891116e+01, 629.59997153),
     ( 30.54878284,  8.63886760e+01, 629.59997153),
     ( 20.51471432,  8.66919017e+01, 629.59997153),
     (  8.87923794,  8.68706359e+01, 629.59997153),
     (356.42132249,  8.69032357e+01, 629.59997153),
     (344.3056594 ,  8.67852503e+01, 629.59997153),
     (333.52847465,  8.65320218e+01, 629.59997153),
     (324.53491904,  8.61702986e+01, 629.59997153),
     (317.28825519,  8.57275688e+01, 629.59997153),
     (311.52521889,  8.52263419e+01, 629.59997153),
     (306.94165647,  8.46831629e+01, 629.59997153),
     (303.27141217,  8.41096560e+01, 629.59997153),
     (300.30435917,  8.35138923e+01, 629.59997153),
     (297.8812238 ,  8.29015066e+01, 629.59997153),
     (295.88283094,  8.22764861e+01, 629.59997153),
     (294.21996954,  8.16416999e+01, 629.59997153),
     (292.8253914 ,  8.09992504e+01, 629.59997153),
     (291.64789255,  8.03507049e+01, 629.59997153),
     (290.64804286,  7.96972524e+01, 629.59997153),
     (289.79512546,  7.90398085e+01, 629.59997153),
     (289.06493832,  7.83790896e+01, 629.59997153),
     (288.43820429,  7.77156631e+01, 629.59997153),
     (287.8994107 ,  7.70499848e+01, 629.59997153),
     (287.43595363,  7.63824248e+01, 629.59997153),
     (287.0375003 ,  7.57132874e+01, 629.59997153),
     (286.69550879,  7.50428249e+01, 629.59997153),
     (286.40286268,  7.43712488e+01, 629.59997153),
     (286.15359017,  7.36987380e+01, 629.59997153),
     (285.9426463 ,  7.30254454e+01, 629.59997153),
     (285.76574234,  7.23515022e+01, 629.59997153),
     (285.61921119,  7.16770224e+01, 629.59997153),
     (285.49990024,  7.10021056e+01, 629.59997153),
     (285.40508539,  7.03268395e+01, 629.59997153),
     (285.33240167,  6.96513019e+01, 629.59997153),
     (285.27978679,  6.89755622e+01, 629.59997153),
     (285.24543494,  6.82996827e+01, 629.59997153),
     (285.22775872,  6.76237200e+01, 629.59997153),
     (285.22535766,  6.69477254e+01, 629.59997153),
     (285.23699199,  6.62717459e+01, 629.59997153),
     (285.26156065,  6.55958249e+01, 629.59997153),
     (285.29808283,  6.49200024e+01, 629.59997153),
     (285.34568241,  6.42443159e+01, 629.59997153),
     (285.40357463,  6.35688002e+01, 629.59997153),
     (285.47105488,  6.28934884e+01, 629.59997153),
     (285.54748899,  6.22184115e+01, 629.59997153),
     (285.63230496,  6.15435989e+01, 629.59997153),
     (285.72498581,  6.08690790e+01, 629.59997153),
     (285.82506336,  6.01948786e+01, 629.59997153),
     (285.9321129 ,  5.95210236e+01, 629.59997153),
     (286.04574847,  5.88475391e+01, 629.59997153),
     (286.16561884,  5.81744494e+01, 629.59997153),
     (286.29140388,  5.75017779e+01, 629.59997153),
     (286.42281143,  5.68295476e+01, 629.59997153),
     (286.55957455,  5.61577810e+01, 629.59997153),
     (286.70144908,  5.54864999e+01, 629.59997153),
     (286.84821144,  5.48157261e+01, 629.59997153),
     (286.99965678,  5.41454808e+01, 629.59997153),
     (287.15559721,  5.34757850e+01, 629.59997153),
     (287.31586033,  5.28066595e+01, 629.59997153),
     (287.48028784,  5.21381250e+01, 629.59997153),
     (287.64873435,  5.14702017e+01, 629.59997153),
     (287.82106628,  5.08029102e+01, 629.59997153),
     (287.99716089,  5.01362707e+01, 629.59997153),
     (288.1769054 ,  4.94703035e+01, 629.59997153),
     (288.3601962 ,  4.88050286e+01, 629.59997153),
     (288.54693811,  4.81404664e+01, 629.59997153),
     (288.73704379,  4.74766371e+01, 629.59997153),
     (288.9304331 ,  4.68135610e+01, 629.59997153),
     (289.1270326 ,  4.61512585e+01, 629.59997153),
     (289.32677504,  4.54897499e+01, 629.59997153),
     (289.52959897,  4.48290560e+01, 629.59997153),
     (289.73544828,  4.41691973e+01, 629.59997153),
     (289.94427189,  4.35101947e+01, 629.59997153),
     (290.15602336,  4.28520693e+01, 629.59997153),
     (290.37066066,  4.21948422e+01, 629.59997153),
     (290.58814581,  4.15385347e+01, 629.59997153),
     (290.80844471,  4.08831684e+01, 629.59997153),
     (291.03152682,  4.02287651e+01, 629.59997153),
     (291.257365  ,  3.95753469e+01, 629.59997153),
     (291.48593532,  3.89229359e+01, 629.59997153),
     (291.71721684,  3.82715547e+01, 629.59997153),
     (291.95119145,  3.76212260e+01, 629.59997153),
     (292.18784374,  3.69719729e+01, 629.59997153),
     (292.42716085,  3.63238188e+01, 629.59997153),
     (292.66913231,  3.56767873e+01, 629.59997153),
     (292.91374996,  3.50309024e+01, 629.59997153),
     (293.16100781,  3.43861884e+01, 629.59997153),
     (293.41090195,  3.37426698e+01, 629.59997153),
     (293.66343043,  3.31003717e+01, 629.59997153),
     (293.9185932 ,  3.24593194e+01, 629.59997153),
     (294.17639201,  3.18195387e+01, 629.59997153),
     (294.43683035,  3.11810555e+01, 629.59997153),
     (294.69991333,  3.05438965e+01, 629.59997153),
     (294.96564769,  2.99080885e+01, 629.59997154),
     (295.23404165,  2.92736588e+01, 629.59997154),
     (295.50510492,  2.86406351e+01, 629.59997154),
     (295.77884863,  2.80090457e+01, 629.59997154),
     (296.05528525,  2.73789192e+01, 629.59997154),
     (296.33442856,  2.67502846e+01, 629.59997154),
     (296.61629362,  2.61231716e+01, 629.59997154),
     (296.9008967 ,  2.54976102e+01, 629.59997154),
     (297.18825527,  2.48736310e+01, 629.59997154),
     (297.47838794,  2.42512649e+01, 629.59997154),
     (297.77131441,  2.36305437e+01, 629.59997154),
     (298.06705548,  2.30114994e+01, 629.59997154),
     (298.36563299,  2.23941647e+01, 629.59997154),
     (298.66706979,  2.17785729e+01, 629.59997154),
     (298.97138971,  2.11647577e+01, 629.59997154),
     (299.27861753,  2.05527535e+01, 629.59997154),
     (299.58877898,  1.99425953e+01, 629.59997154),
     (299.90190067,  1.93343187e+01, 629.59997154),
     (300.2180101 ,  1.87279598e+01, 629.59997154),
     (300.53713562,  1.81235557e+01, 629.59997154),
     (300.8593064 ,  1.75211436e+01, 629.59997154),
     (301.18455243,  1.69207618e+01, 629.59997154),
     (301.51290446,  1.63224491e+01, 629.59997154),
     (301.84439401,  1.57262451e+01, 629.59997154),
     (302.17905333,  1.51321898e+01, 629.59997154),
     (302.51691539,  1.45403243e+01, 629.59997154),
     (302.85801384,  1.39506902e+01, 629.59997154),
     (303.202383  ,  1.33633298e+01, 629.59997154),
     (303.55005782,  1.27782864e+01, 629.59997154),
     (303.90107389,  1.21956037e+01, 629.59997154),
     (304.25546736,  1.16153265e+01, 629.59997154),
     (304.61327499,  1.10375003e+01, 629.59997154),
     (304.97453405,  1.04621712e+01, 629.59997154),
     (305.33928233,  9.88938648e+00, 629.59997154),
     (305.70755814,  9.31919396e+00, 629.59997154),
     (306.07940021,  8.75164240e+00, 629.59997154),
     (306.45484773,  8.18678143e+00, 629.59997154),
     (306.83394028,  7.62466151e+00, 629.59997154),
     (307.21671783,  7.06533401e+00, 629.59997154),
     (307.60322067,  6.50885117e+00, 629.59997154),
     (307.99348941,  5.95526613e+00, 629.59997154),
     (308.3875649 ,  5.40463297e+00, 629.59997154),
     (308.78548828,  4.85700665e+00, 629.59997154),
     (309.18730082,  4.31244310e+00, 629.59997154),
     (309.593044  ,  3.77099917e+00, 629.59997154),
     (310.00275939,  3.23273269e+00, 629.59997154),
     (310.41648862,  2.69770243e+00, 629.59997154),
     (310.83427336,  2.16596814e+00, 629.59997154),
     (311.25615526,  1.63759053e+00, 629.59997154),
     (311.68217588,  1.11263133e+00, 629.59997154),
     (312.11237667,  5.91153243e-01, 629.59997154),
     (312.5467989 ,  7.32199602e-02, 629.59997154),
     (312.98548358, -4.41103810e-01, 629.59997154),
     (313.42847146, -9.51752358e-01, 629.59997154),
     (313.87580291, -1.45865897e+00, 629.59997154),
     (314.32751788, -1.96175590e+00, 629.59997154),
     (314.78365585, -2.46097443e+00, 629.59997154),
     (315.24425573, -2.95624480e+00, 629.59997154),
     (315.70935579, -3.44749624e+00, 629.59997154),
     (316.17899362, -3.93465700e+00, 629.59997154),
     (316.65320601, -4.41765429e+00, 629.59997154),
     (317.13202889, -4.89641437e+00, 629.59997154),
     (317.61549724, -5.37086248e+00, 629.59997154),
     (318.10364503, -5.84092289e+00, 629.59997154),
     (318.59650507, -6.30651890e+00, 629.59997154),
     (319.094109  , -6.76757286e+00, 629.59997154),
     (319.59648711, -7.22400619e+00, 629.59997154),
     (320.10366831, -7.67573936e+00, 629.59997154),
     (320.61567999, -8.12269198e+00, 629.59997154),
     (321.13254794, -8.56478273e+00, 629.59997154),
     (321.65429623, -9.00192947e+00, 629.59997154),
     (322.1809471 , -9.43404919e+00, 629.59997154),
     (322.71252086, -9.86105813e+00, 629.59997154),
     (323.24903577, -1.02828717e+01, 629.59997154),
     (323.79050794, -1.06994046e+01, 629.59997154),
     (324.33695118, -1.11105708e+01, 629.59997154),
     (324.88837693, -1.15162837e+01, 629.59997154),
     (325.44479408, -1.19164560e+01, 629.59997154),
     (326.00620892, -1.23109997e+01, 629.59997154),
     (326.57262496, -1.26998265e+01, 629.59997154),
     (327.14404281, -1.30828476e+01, 629.59997154),
     (327.72046011, -1.34599736e+01, 629.59997154),
     (328.30187136, -1.38311149e+01, 629.59997154),
     (328.88826781, -1.41961815e+01, 629.59997154),
     (329.47963733, -1.45550832e+01, 629.59997154),
     (330.07596431, -1.49077297e+01, 629.59997154),
     (330.67722954, -1.52540304e+01, 629.59997154),
     (331.28341007, -1.55938949e+01, 629.59997154),
     (331.89447912, -1.59272327e+01, 629.59997154),
     (332.51040596, -1.62539535e+01, 629.59997154),
     (333.13115581, -1.65739671e+01, 629.59997154),
     (333.75668973, -1.68871838e+01, 629.59997154)]&gt;
</pre></div>
</div>
</div>
</div>
<p>There is a lot of information in the representation of our transformed <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code>, but note that the frame of the new object is now correctly noted as <code class="docutils literal notranslate"><span class="pre">AltAz</span></code>, as in<code class="docutils literal notranslate"><span class="pre">&lt;SkyCoord</span> <span class="pre">(AltAz:</span> <span class="pre">...</span></code>. Like transforming to <code class="docutils literal notranslate"><span class="pre">Galactic</span></code> coordinates above, the new <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object now contains the data in a new representation, so the ICRS component names <code class="docutils literal notranslate"><span class="pre">.ra</span></code> and <code class="docutils literal notranslate"><span class="pre">.dec</span></code> will not work on this new object. Instead, the data (the altitude and azimuth as a function of time) can be accessed with the <code class="docutils literal notranslate"><span class="pre">.alt</span></code> and <code class="docutils literal notranslate"><span class="pre">.az</span></code> component names. For example, let’s plot the altitude of this open cluster over the course of the night:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_grid</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">oc_altaz</span><span class="o">.</span><span class="n">alt</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Date/Time [UTC]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Altitude [deg]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_majorticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f6eef89cb870fede980f40744baed6a4130c3e86be90402cd539e30f0d902fc1.png" src="_images/f6eef89cb870fede980f40744baed6a4130c3e86be90402cd539e30f0d902fc1.png" />
</div>
</div>
<p>Here we can see that this open cluster reaches a high altitude above the horizon from Kitt Peak, and so it looks like it would be observable from this site. The above curve only shows the altitude trajectory for the first open cluster in our catalog, but we would like to compute the equivalent for <em>all</em> of the open clusters in the catalog. To do this, we have to make use of a concept that is used heavily in Numpy: <a class="reference external" href="https://numpy.org/doc/stable/user/basics.broadcasting.html">array broadcasting</a>. We have 474 open clusters and we want to evaluate the <code class="docutils literal notranslate"><span class="pre">AltAz</span></code> coordinates of these clusters at 256 different times.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">open_cluster_c</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">altaz</span><span class="o">.</span><span class="n">obstime</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(474, 256)
</pre></div>
</div>
</div>
</div>
<p>We therefore want to produce a two-dimensional coordinate object that is indexed along one axis by the open cluster index, and along other axis by the time index. The <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> transformation machinery supports array-like broadcasting, so we can do this by creating new, unmatched, length-1 axes on both the open clusters <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object and the <code class="docutils literal notranslate"><span class="pre">AltAz</span></code> frame using <code class="docutils literal notranslate"><span class="pre">numpy.newaxis</span></code> (<a class="reference external" href="https://numpy.org/doc/stable/reference/constants.html?highlight=newaxis#numpy.newaxis">doc</a>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">open_cluster_altaz</span> <span class="o">=</span> <span class="n">open_cluster_c</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">altaz</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s now over-plot the trajectories for the first 10 open clusters in the catalog:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_grid</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">open_cluster_altaz</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">alt</span><span class="o">.</span><span class="n">degree</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Date/Time [UTC]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Altitude [deg]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_majorticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/11680e3b9c73b759121a2be2f78b2c68d42c2f7b18bb32d6fe023c809e74b73f.png" src="_images/11680e3b9c73b759121a2be2f78b2c68d42c2f7b18bb32d6fe023c809e74b73f.png" />
</div>
</div>
<p>From this, we can see that only two of the clusters in this batch seem to be easily observable.</p>
</section>
<section id="potential-caveats">
<h2>Potential Caveats<a class="headerlink" href="#potential-caveats" title="Link to this heading">#</a></h2>
<p>Transformations between some reference frames require knowing more information about a source. For example, the transformation from ICRS to Galactic coordinates (as demonstrated above) amounts to a 3D rotation, but no change of origin. This transformation is therefore supported for any spherical position (with or without distance information). However, some transformations include a change of origin, and therefore require that the source data (i.e., the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object) has defined distance information. For example, for a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> with only sky position, we can transform from the ICRS to the FK5 coordinate system:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">icrs_c</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">SkyCoord</span><span class="p">(</span><span class="mf">150.4</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="o">-</span><span class="mi">11</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<span class="n">icrs_c</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">FK5</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (FK5: equinox=J2000.000): (ra, dec) in deg
    (150.40000705, -11.00000493)&gt;
</pre></div>
</div>
</div>
</div>
<p>However, we would <strong>NOT</strong> be able to transform this position to the <code class="docutils literal notranslate"><span class="pre">Galactocentric</span></code> frame (<a class="reference external" href="https://docs.astropy.org/en/stable/coordinates/galactocentric.html">docs</a>), because this transformation involves a shift of origin from the solar system barycenter to the Galactic center:</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This cell will raise an exception and will not work (you will see a `ConvertError` exception) - this is expected!</span>

<span class="n">icrs_c</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">Galactocentric</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ConvertError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">35</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># This cell will raise an exception and will not work (you will see a `ConvertError` exception) - this is expected!</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">icrs_c</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">Galactocentric</span><span class="p">())</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/coordinates/sky_coordinate.py:555,</span> in <span class="ni">SkyCoord.transform_to</span><span class="nt">(self, frame, merge_attributes)</span>
<span class="g g-Whitespace">    </span><span class="mi">551</span> <span class="n">generic_frame</span> <span class="o">=</span> <span class="n">GenericFrame</span><span class="p">(</span><span class="n">frame_kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">553</span> <span class="c1"># Do the transformation, returning a coordinate frame of the desired</span>
<span class="g g-Whitespace">    </span><span class="mi">554</span> <span class="c1"># final type (not generic).</span>
<span class="ne">--&gt; </span><span class="mi">555</span> <span class="n">new_coord</span> <span class="o">=</span> <span class="n">trans</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">generic_frame</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">557</span> <span class="c1"># Finally make the new SkyCoord object from the `new_coord` and</span>
<span class="g g-Whitespace">    </span><span class="mi">558</span> <span class="c1"># remaining frame_kwargs that are not frame_attributes in `new_coord`.</span>
<span class="g g-Whitespace">    </span><span class="mi">559</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">new_coord</span><span class="o">.</span><span class="n">frame_attributes</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">frame_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/coordinates/transformations/composite.py:113,</span> in <span class="ni">CompositeTransform.__call__</span><span class="nt">(self, fromcoord, toframe)</span>
<span class="g g-Whitespace">    </span><span class="mi">110</span>             <span class="n">frattrs</span><span class="p">[</span><span class="n">inter_frame_attr_nm</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr</span>
<span class="g g-Whitespace">    </span><span class="mi">112</span>     <span class="n">curr_toframe</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">tosys</span><span class="p">(</span><span class="o">**</span><span class="n">frattrs</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">113</span>     <span class="n">curr_coord</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="n">curr_coord</span><span class="p">,</span> <span class="n">curr_toframe</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">115</span> <span class="c1"># this is safe even in the case where self.transforms is empty, because</span>
<span class="g g-Whitespace">    </span><span class="mi">116</span> <span class="c1"># coordinate objects are immutable, so copying is not needed</span>
<span class="g g-Whitespace">    </span><span class="mi">117</span> <span class="k">return</span> <span class="n">curr_coord</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/coordinates/transformations/affine.py:205,</span> in <span class="ni">BaseAffineTransform.__call__</span><span class="nt">(self, fromcoord, toframe)</span>
<span class="g g-Whitespace">    </span><span class="mi">204</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fromcoord</span><span class="p">,</span> <span class="n">toframe</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">205</span>     <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_affine_params</span><span class="p">(</span><span class="n">fromcoord</span><span class="p">,</span> <span class="n">toframe</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">206</span>     <span class="n">newrep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_transform</span><span class="p">(</span><span class="n">fromcoord</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">207</span>     <span class="k">return</span> <span class="n">toframe</span><span class="o">.</span><span class="n">realize_frame</span><span class="p">(</span><span class="n">newrep</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/coordinates/transformations/affine.py:259,</span> in <span class="ni">AffineTransform._affine_params</span><span class="nt">(self, fromcoord, toframe)</span>
<span class="g g-Whitespace">    </span><span class="mi">258</span> <span class="k">def</span><span class="w"> </span><span class="nf">_affine_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fromcoord</span><span class="p">,</span> <span class="n">toframe</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">259</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_func</span><span class="p">(</span><span class="n">fromcoord</span><span class="p">,</span> <span class="n">toframe</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/coordinates/builtin_frames/galactocentric.py:592,</span> in <span class="ni">icrs_to_galactocentric</span><span class="nt">(icrs_coord, galactocentric_frame)</span>
<span class="g g-Whitespace">    </span><span class="mi">590</span> <span class="nd">@frame_transform_graph</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">AffineTransform</span><span class="p">,</span> <span class="n">ICRS</span><span class="p">,</span> <span class="n">Galactocentric</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">591</span> <span class="k">def</span><span class="w"> </span><span class="nf">icrs_to_galactocentric</span><span class="p">(</span><span class="n">icrs_coord</span><span class="p">,</span> <span class="n">galactocentric_frame</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">592</span>     <span class="n">_check_coord_repr_diff_types</span><span class="p">(</span><span class="n">icrs_coord</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">593</span>     <span class="k">return</span> <span class="n">get_matrix_vectors</span><span class="p">(</span><span class="n">galactocentric_frame</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/coordinates/builtin_frames/galactocentric.py:571,</span> in <span class="ni">_check_coord_repr_diff_types</span><span class="nt">(c)</span>
<span class="g g-Whitespace">    </span><span class="mi">569</span> <span class="k">def</span><span class="w"> </span><span class="nf">_check_coord_repr_diff_types</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">570</span>     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">UnitSphericalRepresentation</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">571</span>         <span class="k">raise</span> <span class="n">ConvertError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">572</span>             <span class="s2">&quot;Transforming to/from a Galactocentric frame requires a 3D coordinate, e.g.&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">573</span>             <span class="s2">&quot; (angle, angle, distance) or (x, y, z).&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">574</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">576</span>     <span class="k">if</span> <span class="s2">&quot;s&quot;</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">differentials</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">577</span>         <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">differentials</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">578</span>         <span class="p">(</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>    <span class="mi">582</span>         <span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">583</span>     <span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">584</span>         <span class="k">raise</span> <span class="n">ConvertError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span>             <span class="s2">&quot;Transforming to/from a Galactocentric frame requires a 3D velocity, e.g.,&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">586</span>             <span class="s2">&quot; proper motion components and radial velocity.&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span>         <span class="p">)</span>

<span class="ne">ConvertError</span>: Transforming to/from a Galactocentric frame requires a 3D coordinate, e.g. (angle, angle, distance) or (x, y, z).
</pre></div>
</div>
</div>
</div>
<p>In this tutorial, we have introduced the key concepts that underly the <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> framework: coordinate component formats, representations, and frames. We demonstrated how to change the representation of a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object (e.g., Cartesian to Cylindrical). We then introduce the concept of coordinate frames and frame transformations.</p>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<p>Przybylski’s star or HD101065 is in the southern constellation of Centaurus with a right ascension of 174.4040348 degrees and a declination of -46.70953633 degrees. Create a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object of its sky position.</p>
<p>If the distance to Przybylski’s star is 108.4 pc, retrieve a 3D Cartesian representation. (Hint: we did this earlier in the tutorial and it may help to create a new 3D <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object.)</p>
<p>Imagine it is May 2018, and you would like to take an observation of HD 101065 from Greenwich Royal Observatory. Use astropy.coordinates to figure out if you can observe the star that month (hint: use the <code class="docutils literal notranslate"><span class="pre">EarthLocation</span></code> class). You can use any time and date of that month for your timeframe.</p>
</section>
</section>
<span id="document-3_Coordinates-Velocities"></span><section class="tex2jax_ignore mathjax_ignore" id="astronomical-coordinates-3-working-with-velocity-data-in-astropy-coordinates">
<h1>Astronomical Coordinates 3: Working with Velocity Data in astropy.coordinates<a class="headerlink" href="#astronomical-coordinates-3-working-with-velocity-data-in-astropy-coordinates" title="Link to this heading">#</a></h1>
<section id="authors">
<h2>Authors<a class="headerlink" href="#authors" title="Link to this heading">#</a></h2>
<p>Adrian Price-Whelan, Saima Siddiqui, Luthien Liu, Zihao Chen</p>
</section>
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Introduce how to represent and transform velocity data in <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> objects</p></li>
<li><p>Demonstrate how to predict the position of a star at a time using its proper motion</p></li>
</ul>
</section>
<section id="keywords">
<h2>Keywords<a class="headerlink" href="#keywords" title="Link to this heading">#</a></h2>
<p>coordinates, OOP, astroquery, gaia</p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>In the previous tutorial in this series, we showed how astronomical <em>positional</em> coordinates can be represented and transformed in Python using the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object (<a class="reference external" href="https://docs.astropy.org/en/stable/coordinates/skycoord.html">docs</a>). Many sources, especially stars (thanks to the Gaia mission), have measured velocities or measured components of their velocity (e.g., just proper motion, or just radial velocity).</p>
<p>In this tutorial, we will explore how the <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> package can be used to represent and transform astronomical coordinates that have associated velocity data. You may find it helpful to keep <a class="reference external" href="http://docs.astropy.org/en/stable/coordinates/index.html">the Astropy documentation for the coordinates package</a> open alongside this tutorial for reference or additional reading. In the text below, you may also see some links that look like (<a class="reference external" href="http://docs.astropy.org/en/stable/coordinates/index.html">docs</a>). These links will take you to parts of the documentation that are directly relevant to the cells from which they link.</p>
<p><em>Note: This is the 3rd tutorial in a series of tutorials about astropy.coordinates. If you are new to astropy.coordinates, you may want to start from the beginning or an earlier tutorial.</em></p>
</section>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h2>
<p>We start by importing some general packages we will need below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">astropy</span><span class="w"> </span><span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.coordinates</span><span class="w"> </span><span class="kn">import</span> <span class="n">SkyCoord</span><span class="p">,</span> <span class="n">Distance</span><span class="p">,</span> <span class="n">Galactic</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">astropy.coordinates</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">coord</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.time</span><span class="w"> </span><span class="kn">import</span> <span class="n">Time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.utils.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">download_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.wcs</span><span class="w"> </span><span class="kn">import</span> <span class="n">WCS</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.gaia</span><span class="w"> </span><span class="kn">import</span> <span class="n">Gaia</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="more-than-sky-positions-including-velocity-data-in-skycoord">
<h2>More Than Sky Positions: Including Velocity Data in <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code><a class="headerlink" href="#more-than-sky-positions-including-velocity-data-in-skycoord" title="Link to this heading">#</a></h2>
<p>As we have seen in the previous tutorials, the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object can be used to store scalars or arrays of positional coordinate information and supports transforming between different coordinate frames and representations. But  <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> also supports representing and transforming <em>velocity</em> information along with positions (<a class="reference external" href="http://docs.astropy.org/en/latest/coordinates/velocities.html">docs</a>).</p>
</section>
<section id="passing-velocity-data-into-skycoord">
<h2>Passing Velocity Data into <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code><a class="headerlink" href="#passing-velocity-data-into-skycoord" title="Link to this heading">#</a></h2>
<p>Velocity components are passed in to <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> in the same way that positional components are specified: As arguments to the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> class. For example, to create a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> to represent a sky position and a proper motion in the (default) ICRS coordinate frame, in addition to the position components <code class="docutils literal notranslate"><span class="pre">ra</span></code>, <code class="docutils literal notranslate"><span class="pre">dec</span></code>, we can pass in values for the proper motion components <code class="docutils literal notranslate"><span class="pre">pm_ra_cosdec</span></code>, <code class="docutils literal notranslate"><span class="pre">pm_dec</span></code> (“pm” for “proper motion”):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SkyCoord</span><span class="p">(</span>
    <span class="n">ra</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
    <span class="n">dec</span><span class="o">=</span><span class="mi">20</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
    <span class="n">pm_ra_cosdec</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
    <span class="n">pm_dec</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (ICRS): (ra, dec) in deg
    (10., 20.)
 (pm_ra_cosdec, pm_dec) in mas / yr
    (1., 2.)&gt;
</pre></div>
</div>
</div>
</div>
<p>Here, you may notice that the proper motion in right ascension has “cosdec” in the name: This is to explicitly note that the input here is expected to be the proper motion scaled by the cosine of the declination, which accounts for the fact that a change in longitude (right ascension) has different physical length at different latitudes (declinations).</p>
<p>Like the examples in previous tutorials demonstrated for positional coordinates, we can also create an array-valued <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object by passing in arrays of data for all of the components. In this case, each value in the inputed array represents a quantity of an object among large data set. This method would be beneficial when dealing with large number of star collections like a star cluster:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SkyCoord</span><span class="p">(</span>
    <span class="n">ra</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
    <span class="n">dec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
    <span class="n">pm_ra_cosdec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
    <span class="n">pm_dec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (ICRS): (ra, dec) in deg
    [( 0. ,  5.  ), ( 2.5,  8.75), ( 5. , 12.5 ), ( 7.5, 16.25),
     (10. , 20.  )]
 (pm_ra_cosdec, pm_dec) in mas / yr
    [(-5. , -5. ), (-2.5, -2.5), ( 0. ,  0. ), ( 2.5,  2.5), ( 5. ,  5. )]&gt;
</pre></div>
</div>
</div>
</div>
<p>However, for some of the examples below we will continue to use scalar values for brevity.</p>
<p>You can also specify radial velocity data with the <code class="docutils literal notranslate"><span class="pre">radial_velocity</span></code> argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">velocity_coord</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span>
    <span class="n">ra</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
    <span class="n">dec</span><span class="o">=</span><span class="mi">20</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
    <span class="n">pm_ra_cosdec</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
    <span class="n">pm_dec</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
    <span class="n">radial_velocity</span><span class="o">=</span><span class="mi">100</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">velocity_coord</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (ICRS): (ra, dec) in deg
    (10., 20.)
 (pm_ra_cosdec, pm_dec, radial_velocity) in (mas / yr, mas / yr, km / s)
    (1., 2., 100.)&gt;
</pre></div>
</div>
</div>
</div>
<p>The component data can then be accessed using the same names used to pass in the velocity components:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">velocity_coord</span><span class="o">.</span><span class="n">pm_ra_cosdec</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[1 \; \mathrm{\frac{mas}{yr}}\]</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">velocity_coord</span><span class="o">.</span><span class="n">radial_velocity</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[100 \; \mathrm{\frac{km}{s}}\]</div>
</div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object with velocity data can be transformed to other frames just like the position-only coordinate objects we used in the previous tutorials:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">velocity_coord_gal</span> <span class="o">=</span> <span class="n">velocity_coord</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">Galactic</span><span class="p">())</span>
<span class="n">velocity_coord_gal</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (Galactic): (l, b) in deg
    (119.26936774, -42.79039286)
 (pm_l_cosb, pm_b, radial_velocity) in (mas / yr, mas / yr, km / s)
    (1.11917063, 1.93583499, 100.)&gt;
</pre></div>
</div>
</div>
</div>
<p>Note that, like the position components, which change from <code class="docutils literal notranslate"><span class="pre">ra</span></code>,<code class="docutils literal notranslate"><span class="pre">dec</span></code> to <code class="docutils literal notranslate"><span class="pre">l</span></code>,<code class="docutils literal notranslate"><span class="pre">b</span></code>, the proper motion component names have changed to reflect naming conventions for the component names in a given frame: <code class="docutils literal notranslate"><span class="pre">pm_ra_cosdec</span></code> and <code class="docutils literal notranslate"><span class="pre">pm_dec</span></code> have become <code class="docutils literal notranslate"><span class="pre">pm_l_cosb</span></code> and <code class="docutils literal notranslate"><span class="pre">pm_b</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">velocity_coord_gal</span><span class="o">.</span><span class="n">pm_l_cosb</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[1.1191706 \; \mathrm{\frac{mas}{yr}}\]</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">velocity_coord_gal</span><span class="o">.</span><span class="n">pm_b</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[1.935835 \; \mathrm{\frac{mas}{yr}}\]</div>
</div>
</div>
<p>An important caveat to note when transforming a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object with velocity data is that some reference frames require knowing the distances, or the full velocity vectors (i.e. proper motion components and radial velocity) in order to transform the velocities correctly. For example, a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> with only sky position and proper motion data <strong>CANNOT</strong> be transformed to a frame with a positional or velocity offset, such as the <code class="docutils literal notranslate"><span class="pre">Galactocentric</span></code> frame (<a class="reference external" href="https://docs.astropy.org/en/stable/coordinates/galactocentric.html">docs</a>)</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This cell will NOT work (you will receive an ConvertError warning) - this is expected!</span>

<span class="n">test_coord_1</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span>
    <span class="n">ra</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
    <span class="n">dec</span><span class="o">=</span><span class="mi">20</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
    <span class="n">pm_ra_cosdec</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
    <span class="n">pm_dec</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">test_coord_1</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">Galactocentric</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ConvertError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">line</span> <span class="mi">10</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># This cell will NOT work (you will receive an ConvertError warning) - this is expected!</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">test_coord_1</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">ra</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">dec</span><span class="o">=</span><span class="mi">20</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">pm_ra_cosdec</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">pm_dec</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">10</span> <span class="n">test_coord_1</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">Galactocentric</span><span class="p">())</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/coordinates/sky_coordinate.py:555,</span> in <span class="ni">SkyCoord.transform_to</span><span class="nt">(self, frame, merge_attributes)</span>
<span class="g g-Whitespace">    </span><span class="mi">551</span> <span class="n">generic_frame</span> <span class="o">=</span> <span class="n">GenericFrame</span><span class="p">(</span><span class="n">frame_kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">553</span> <span class="c1"># Do the transformation, returning a coordinate frame of the desired</span>
<span class="g g-Whitespace">    </span><span class="mi">554</span> <span class="c1"># final type (not generic).</span>
<span class="ne">--&gt; </span><span class="mi">555</span> <span class="n">new_coord</span> <span class="o">=</span> <span class="n">trans</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">generic_frame</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">557</span> <span class="c1"># Finally make the new SkyCoord object from the `new_coord` and</span>
<span class="g g-Whitespace">    </span><span class="mi">558</span> <span class="c1"># remaining frame_kwargs that are not frame_attributes in `new_coord`.</span>
<span class="g g-Whitespace">    </span><span class="mi">559</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">new_coord</span><span class="o">.</span><span class="n">frame_attributes</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">frame_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/coordinates/transformations/composite.py:113,</span> in <span class="ni">CompositeTransform.__call__</span><span class="nt">(self, fromcoord, toframe)</span>
<span class="g g-Whitespace">    </span><span class="mi">110</span>             <span class="n">frattrs</span><span class="p">[</span><span class="n">inter_frame_attr_nm</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr</span>
<span class="g g-Whitespace">    </span><span class="mi">112</span>     <span class="n">curr_toframe</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">tosys</span><span class="p">(</span><span class="o">**</span><span class="n">frattrs</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">113</span>     <span class="n">curr_coord</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="n">curr_coord</span><span class="p">,</span> <span class="n">curr_toframe</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">115</span> <span class="c1"># this is safe even in the case where self.transforms is empty, because</span>
<span class="g g-Whitespace">    </span><span class="mi">116</span> <span class="c1"># coordinate objects are immutable, so copying is not needed</span>
<span class="g g-Whitespace">    </span><span class="mi">117</span> <span class="k">return</span> <span class="n">curr_coord</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/coordinates/transformations/affine.py:205,</span> in <span class="ni">BaseAffineTransform.__call__</span><span class="nt">(self, fromcoord, toframe)</span>
<span class="g g-Whitespace">    </span><span class="mi">204</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fromcoord</span><span class="p">,</span> <span class="n">toframe</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">205</span>     <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_affine_params</span><span class="p">(</span><span class="n">fromcoord</span><span class="p">,</span> <span class="n">toframe</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">206</span>     <span class="n">newrep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_transform</span><span class="p">(</span><span class="n">fromcoord</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">207</span>     <span class="k">return</span> <span class="n">toframe</span><span class="o">.</span><span class="n">realize_frame</span><span class="p">(</span><span class="n">newrep</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/coordinates/transformations/affine.py:259,</span> in <span class="ni">AffineTransform._affine_params</span><span class="nt">(self, fromcoord, toframe)</span>
<span class="g g-Whitespace">    </span><span class="mi">258</span> <span class="k">def</span><span class="w"> </span><span class="nf">_affine_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fromcoord</span><span class="p">,</span> <span class="n">toframe</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">259</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_func</span><span class="p">(</span><span class="n">fromcoord</span><span class="p">,</span> <span class="n">toframe</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/coordinates/builtin_frames/galactocentric.py:592,</span> in <span class="ni">icrs_to_galactocentric</span><span class="nt">(icrs_coord, galactocentric_frame)</span>
<span class="g g-Whitespace">    </span><span class="mi">590</span> <span class="nd">@frame_transform_graph</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">AffineTransform</span><span class="p">,</span> <span class="n">ICRS</span><span class="p">,</span> <span class="n">Galactocentric</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">591</span> <span class="k">def</span><span class="w"> </span><span class="nf">icrs_to_galactocentric</span><span class="p">(</span><span class="n">icrs_coord</span><span class="p">,</span> <span class="n">galactocentric_frame</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">592</span>     <span class="n">_check_coord_repr_diff_types</span><span class="p">(</span><span class="n">icrs_coord</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">593</span>     <span class="k">return</span> <span class="n">get_matrix_vectors</span><span class="p">(</span><span class="n">galactocentric_frame</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/coordinates/builtin_frames/galactocentric.py:571,</span> in <span class="ni">_check_coord_repr_diff_types</span><span class="nt">(c)</span>
<span class="g g-Whitespace">    </span><span class="mi">569</span> <span class="k">def</span><span class="w"> </span><span class="nf">_check_coord_repr_diff_types</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">570</span>     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">UnitSphericalRepresentation</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">571</span>         <span class="k">raise</span> <span class="n">ConvertError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">572</span>             <span class="s2">&quot;Transforming to/from a Galactocentric frame requires a 3D coordinate, e.g.&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">573</span>             <span class="s2">&quot; (angle, angle, distance) or (x, y, z).&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">574</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">576</span>     <span class="k">if</span> <span class="s2">&quot;s&quot;</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">differentials</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">577</span>         <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">differentials</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">578</span>         <span class="p">(</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>    <span class="mi">582</span>         <span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">583</span>     <span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">584</span>         <span class="k">raise</span> <span class="n">ConvertError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span>             <span class="s2">&quot;Transforming to/from a Galactocentric frame requires a 3D velocity, e.g.,&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">586</span>             <span class="s2">&quot; proper motion components and radial velocity.&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span>         <span class="p">)</span>

<span class="ne">ConvertError</span>: Transforming to/from a Galactocentric frame requires a 3D coordinate, e.g. (angle, angle, distance) or (x, y, z).
</pre></div>
</div>
</div>
</div>
<p>In order to transform to the <code class="docutils literal notranslate"><span class="pre">Galactocentric</span></code> frame, both distance and radial velocity of the object are required.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_coord_2</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span>
    <span class="n">ra</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
    <span class="n">dec</span><span class="o">=</span><span class="mi">20</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
    <span class="n">distance</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="p">,</span>
    <span class="n">pm_ra_cosdec</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
    <span class="n">pm_dec</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
    <span class="n">radial_velocity</span><span class="o">=</span><span class="mi">100</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">test_coord_2</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">Galactocentric</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (Galactocentric: galcen_coord=&lt;ICRS Coordinate: (ra, dec) in deg
    (266.4051, -28.936175)&gt;, galcen_distance=8.122 kpc, galcen_v_sun=(12.9, 245.6, 7.78) km / s, z_sun=20.8 pc, roll=0.0 deg): (x, y, z) in pc
    (-8125.57861635, 6.40155855, 14.01603221)
 (v_x, v_y, v_z) in km / s
    (-23.22908903, 309.64402716, -59.99213843)&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section id="evolving-coordinate-positions-between-epochs">
<h2>Evolving Coordinate Positions Between Epochs<a class="headerlink" href="#evolving-coordinate-positions-between-epochs" title="Link to this heading">#</a></h2>
<p>For nearby or fast-moving stars, a star’s position could change appreciably between two well-spaced observations of the source. For such cases, it might be necessary to compute the position of the star at a given time using the proper motion or velocity of the star. Let’s demonstrate this idea by comparing the sky position of a source as measured by <a class="reference external" href="https://www.cosmos.esa.int/web/gaia/dr2"><em>Gaia</em> Data Release 2</a> (given at the epoch J2015.5) to an image near this source from the Digitized Sky Survey (DSS; digital scans of photographic plates observed in the 1950s).</p>
<p>From previous astrometric measurements, we know that the star HD 219829 has very large proper motion: Close to 0.5 arcsec/year! Between the DSS and <em>Gaia</em>, we therefore expect that the position of the star has changed by about 0.5 arcmin. Let’s see if this is the case!</p>
<p>To start, we will query the <em>Gaia</em> catalog to retrieve data for this star (skip the cell below if you do not have an internet connection - we have provided the table locally as well). We use a large search radius so many sources will be returned</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Skip this cell if you are not connected to the internet</span>
<span class="n">gaia_tbl</span> <span class="o">=</span> <span class="n">Gaia</span><span class="o">.</span><span class="n">query_object</span><span class="p">(</span><span class="n">SkyCoord</span><span class="o">.</span><span class="n">from_name</span><span class="p">(</span><span class="s2">&quot;HD 219829&quot;</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcmin</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the .read() below produces some warnings that we can safely ignore</span>
<span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

    <span class="n">gaia_tbl</span> <span class="o">=</span> <span class="n">QTable</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;HD_219829_query_results.ecsv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We know that HD 219829 will be the brightest source in this small region, so we can extract the row with the smallest G-band magnitude. Let’s check the proper motion values for this source to make sure that they are large:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hd219829_row</span> <span class="o">=</span> <span class="n">gaia_tbl</span><span class="p">[</span><span class="n">gaia_tbl</span><span class="p">[</span><span class="s2">&quot;phot_g_mean_mag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
<span class="n">hd219829_row</span><span class="p">[</span><span class="s2">&quot;source_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pmra&quot;</span><span class="p">,</span> <span class="s2">&quot;pmdec&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><i>Row index=2</i>
<table id="table140709306297104">
<thead><tr><th>source_id</th><th>pmra</th><th>pmdec</th></tr></thead>
<thead><tr><th></th><th>mas / yr</th><th>mas / yr</th></tr></thead>
<thead><tr><th>int64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>2661015540210781568</td><td>483.4165901889734</td><td>-114.8633971841528</td></tr>
</table></div></div>
</div>
<p>Indeed, it looks like this is our source! Let’s construct a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object for this source using the data from the <em>Gaia</em> archive:</p>
<p><em>Note about the Gaia catalog proper motion column names: The names in the Gaia archive and other repositories containing Gaia data give Right Ascension proper motion values simply as “pmra”. These components implicitly contain the <code class="docutils literal notranslate"><span class="pre">cos(dec)</span></code> term, so we do <strong>not</strong> have to modify these values in order to pass them in to <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> as <code class="docutils literal notranslate"><span class="pre">pm_ra_cosdec</span></code></em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hd219829_coord</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span>
    <span class="n">ra</span><span class="o">=</span><span class="n">hd219829_row</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">],</span>
    <span class="n">dec</span><span class="o">=</span><span class="n">hd219829_row</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">],</span>
    <span class="n">distance</span><span class="o">=</span><span class="n">Distance</span><span class="p">(</span><span class="n">parallax</span><span class="o">=</span><span class="n">hd219829_row</span><span class="p">[</span><span class="s2">&quot;parallax&quot;</span><span class="p">]),</span>
    <span class="n">pm_ra_cosdec</span><span class="o">=</span><span class="n">hd219829_row</span><span class="p">[</span><span class="s2">&quot;pmra&quot;</span><span class="p">],</span>
    <span class="n">pm_dec</span><span class="o">=</span><span class="n">hd219829_row</span><span class="p">[</span><span class="s2">&quot;pmdec&quot;</span><span class="p">],</span>
    <span class="n">obstime</span><span class="o">=</span><span class="n">Time</span><span class="p">(</span><span class="n">hd219829_row</span><span class="p">[</span><span class="s2">&quot;ref_epoch&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;jyear&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">hd219829_coord</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (ICRS): (ra, dec, distance) in (deg, deg, pc)
    (349.72896716, 5.40511585, 34.47896069)
 (pm_ra_cosdec, pm_dec) in mas / yr
    (483.41659019, -114.86339718)&gt;
</pre></div>
</div>
</div>
</div>
<p>We now have a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> representation of the position and proper motion of the star HD 219829 as measured by <em>Gaia</em> and reported at the epoch J2015.5. What does this mean exactly? <em>Gaia</em> actually measures the (time-dependent) position of a star every time it scans the part of the sky that contains the source, and this is how <em>Gaia</em> is able to measure proper motions of stars. However, if every star is moving and changing its sky positions, how do we ever talk about “the sky position” of a star as opposed to “the sky trajectory of a star”?! The key is that catalogs often only report the position of a source at some reference epoch. For a survey that only observes the sky once or a few times (e.g., SDSS or 2MASS), this reference epoch might be “the time that the star was observed.” But for a mission like <em>Gaia</em>, which scans the sky many times, they perform astrometric fits to the individual position measurements, which allow them to measure the parallax, proper motion, and the reference position at a reference time for each source. For <em>Gaia</em> data release 2, the reference time is J2015.5, and the sky positions (and other quantities) reported in the catalog for each source are at this epoch.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code>, we specify the “epoch” of an observation using the <code class="docutils literal notranslate"><span class="pre">obstime</span></code> argument, as we did above. Now that we have a coordinate object for HD 219829, let’s now compare the position of the star as measured by <em>Gaia</em> to its apparent position in an image from the DSS. Let’s now query the DSS to retrieve a FITS image of the field around this star, using the STSCI DSS image cutout service. Skip the cell below if you do not have an internet connection (we have provided the image locally as well):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Skip this cell if you are not connected to the internet</span>
<span class="n">dss_cutout_filename</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;http://archive.stsci.edu/cgi-bin/dss_search?&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;f=FITS&amp;ra=</span><span class="si">{</span><span class="n">hd219829_coord</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">degree</span><span class="si">}</span><span class="s2">&amp;dec=</span><span class="si">{</span><span class="n">hd219829_coord</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">degree</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;&amp;width=4&amp;height=4&quot;</span>
<span class="p">)</span>  <span class="c1"># width/height in arcmin</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dss_cutout_filename</span> <span class="o">=</span> <span class="s2">&quot;dss_hd219829.fits&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>We can now load the FITS image of the cutout and use <code class="docutils literal notranslate"><span class="pre">astropy.visualization</span></code> to display the image using its World Coordinate System (WCS) info (<a class="reference external" href="http://docs.astropy.org/en/latest/visualization/wcsaxes/index.html">docs</a>). By passing in the WCS information (included in the FITS cutout header), we can over-plot a marker for the <em>Gaia</em>-measured sky position of HD 219829:</p>
<p>(If you are unfamiliar with the usage of FITS header and FITS image, check out these 2 tutorials having detailed explanation on these 2 topics: <a class="reference external" href="https://learn.astropy.org/tutorials/FITS-header.html">FITS-Header</a> and <a class="reference external" href="https://learn.astropy.org/tutorials/FITS-images.html">FITS-Image</a>.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">dss_cutout_filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">wcs</span> <span class="o">=</span> <span class="n">WCS</span><span class="p">(</span><span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">wcs</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys_r&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;RA&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Dec&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_autoscale_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">hd219829_coord</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span>
    <span class="n">hd219829_coord</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="s2">&quot;world&quot;</span><span class="p">),</span>
    <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:red&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 33867.416667 from DATE-OBS&#39;. [astropy.wcs.wcs]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x7ff96124edb0&gt;
</pre></div>
</div>
<img alt="_images/4e8b764d5c9775eeaa678e25cd173327fb44e4f28b5e7c56b3bbd35c3b62e001.png" src="_images/4e8b764d5c9775eeaa678e25cd173327fb44e4f28b5e7c56b3bbd35c3b62e001.png" />
</div>
</div>
<p>The brighest star (as observed by DSS) in this image is our target, and the red circle is where <em>Gaia</em> observed this star. As we excpected, it has moved quite a bit since the 1950’s! We can account for this motion and predict the position of the star at around the time the DSS plate was observed. Let’s assume that this plate was observed in 1950 exactly (this is not strictly correct, but should get us close enough).</p>
<p>To account for the proper motion of the source and evolve the position to a new time, we can use the <code class="docutils literal notranslate"><span class="pre">SkyCoord.apply_space_motion()</span></code> method (<a class="reference external" href="http://docs.astropy.org/en/latest/api/astropy.coordinates.SkyCoord.html#astropy.coordinates.SkyCoord.apply_space_motion">docs</a>). Because we defined the <code class="docutils literal notranslate"><span class="pre">obstime</span></code> when we defined the coordinate object for HD 219829, for example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hd219829_coord</span><span class="o">.</span><span class="n">obstime</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Time object: scale=&#39;tt&#39; format=&#39;jyear&#39; value=2015.5&gt;
</pre></div>
</div>
</div>
</div>
<p>We can now use <code class="docutils literal notranslate"><span class="pre">apply_space_motion()</span></code> by passing in a new time, <code class="docutils literal notranslate"><span class="pre">new_obstime</span></code>, to compute the coordinates at:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this produces some warnings that we can safely ignore</span>
<span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

    <span class="n">hd219829_coord_1950</span> <span class="o">=</span> <span class="n">hd219829_coord</span><span class="o">.</span><span class="n">apply_space_motion</span><span class="p">(</span><span class="n">new_obstime</span><span class="o">=</span><span class="n">Time</span><span class="p">(</span><span class="s2">&quot;J1950&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s now plot our predicted position for this source as it would appear in 1950 based on the <em>Gaia</em> position and proper motion:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">wcs</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys_r&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;RA&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Dec&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_autoscale_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">hd219829_coord</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span>
    <span class="n">hd219829_coord</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="s2">&quot;world&quot;</span><span class="p">),</span>
    <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:red&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Plot the predicted (past) position:</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">hd219829_coord_1950</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span>
    <span class="n">hd219829_coord_1950</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="s2">&quot;world&quot;</span><span class="p">),</span>
    <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x7ff960dbc290&gt;
</pre></div>
</div>
<img alt="_images/bd3edbe1b7a72bac407c470833023917c26ed10d498fe562d962f2df05baf64a.png" src="_images/bd3edbe1b7a72bac407c470833023917c26ed10d498fe562d962f2df05baf64a.png" />
</div>
</div>
<p>The red circle is the same as in the previous image and shows the position of the source in the <em>Gaia</em> catalog (in 2015.5). The blue circle shows our prediction for the position of the source in 1950 - this looks much closer to where the star is in the DSS image!</p>
<p>In this tutorial, we have introduced how to store and transform velocity data along with positional data in <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code>. We also demonstrated how to use the velocity of a source to predict its position at an earlier or later time.</p>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<p>Lalande 21185 is the brightest red dwarf star in the northern hemisphere and has a pretty high proper motion. Use the Gaia archive (<a class="reference external" href="https://gea.esac.esa.int/archive/">https://gea.esac.esa.int/archive/</a>) to find values and create a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object for Lalande 21185. (Hint: earlier in the tutorial, we extracted information from a Gaia table and mentioned which Gaia column names match with our postition components).</p>
</section>
</section>
<span id="document-4_Coordinates-Crossmatch"></span><section class="tex2jax_ignore mathjax_ignore" id="astronomical-coordinates-4-cross-matching-catalogs-using-astropy-coordinates-and-astroquery">
<h1>Astronomical Coordinates 4: Cross-matching Catalogs Using astropy.coordinates and astroquery<a class="headerlink" href="#astronomical-coordinates-4-cross-matching-catalogs-using-astropy-coordinates-and-astroquery" title="Link to this heading">#</a></h1>
<section id="authors">
<h2>Authors<a class="headerlink" href="#authors" title="Link to this heading">#</a></h2>
<p>Adrian Price-Whelan</p>
</section>
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Demonstrate how to retrieve a catalog from Vizier using astroquery</p></li>
<li><p>Show how to perform positional cross-matches between catalogs of sky coordinates</p></li>
</ul>
</section>
<section id="keywords">
<h2>Keywords<a class="headerlink" href="#keywords" title="Link to this heading">#</a></h2>
<p>coordinates, OOP, astroquery, gaia</p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>In the previous tutorials in this series, we introduced many of the key concepts underlying how to represent and transform astronomical coordinates using <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code>, including how to work with both position and velocity data within the coordinate objects.</p>
<p>In this tutorial, we will explore how the <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> package can be used to cross-match two catalogs that contain overlapping sources that may have been observed at different times. You may find it helpful to keep <a class="reference external" href="http://docs.astropy.org/en/stable/coordinates/index.html">the Astropy documentation for the coordinates package</a> open alongside this tutorial for reference or additional reading. In the text below, you may also see some links that look like (<a class="reference external" href="http://docs.astropy.org/en/stable/coordinates/index.html">docs</a>). These links will take you to parts of the documentation that are directly relevant to the cells from which they link.</p>
<p><em>Note: This is the 4th tutorial in a series of tutorials about astropy.coordinates. If you are new to astropy.coordinates, you may want to start from the beginning or an earlier tutorial.</em></p>
</section>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h2>
<p>We start by importing some general packages that we will need below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">astropy</span><span class="w"> </span><span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.coordinates</span><span class="w"> </span><span class="kn">import</span> <span class="n">SkyCoord</span><span class="p">,</span> <span class="n">Distance</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.time</span><span class="w"> </span><span class="kn">import</span> <span class="n">Time</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.vizier</span><span class="w"> </span><span class="kn">import</span> <span class="n">Vizier</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="cross-matching-and-comparing-catalogs">
<h2>Cross-matching and comparing catalogs<a class="headerlink" href="#cross-matching-and-comparing-catalogs" title="Link to this heading">#</a></h2>
<p>In this tutorial, we are going to return to a set of data that we downloaded from the <em>Gaia</em> archive back in <a class="reference internal" href="#document-1_Coordinates-Intro"><span class="doc std std-doc">Tutorial 1</span></a> of this series.</p>
<p>Let’s recap what we did in that tutorial: We defined a <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object to represent the center of an open cluster (NGC 188), we queried the <em>Gaia</em> DR2 catalog to select stars that are close (on the sky) to the center of the cluster, and we used the parallax values from <em>Gaia</em> to select stars that are near NGC 188 in 3D position. Here, we will briefly reproduce those selections so that we can start here with a catalog of sources that are likely members of NGC 188 (see <a class="reference internal" href="#1-Coordinates-Intro"><span class="xref myst">Tutorial 1</span></a> for more information):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ngc188_table</span> <span class="o">=</span> <span class="n">QTable</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;gaia_results.fits&quot;</span><span class="p">)</span>
<span class="n">ngc188_table</span> <span class="o">=</span> <span class="n">ngc188_table</span><span class="p">[</span><span class="n">ngc188_table</span><span class="p">[</span><span class="s2">&quot;parallax&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span><span class="p">]</span>

<span class="n">ngc188_center_3d</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span>
    <span class="mf">12.11</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
    <span class="mf">85.26</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
    <span class="n">distance</span><span class="o">=</span><span class="mf">1.96</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">,</span>
    <span class="n">pm_ra_cosdec</span><span class="o">=-</span><span class="mf">2.3087</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
    <span class="n">pm_dec</span><span class="o">=-</span><span class="mf">0.9565</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Deal with masked quantity data in a backwards-compatible way:</span>
<span class="n">parallax</span> <span class="o">=</span> <span class="n">ngc188_table</span><span class="p">[</span><span class="s2">&quot;parallax&quot;</span><span class="p">]</span>
<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">parallax</span><span class="p">,</span> <span class="s2">&quot;mask&quot;</span><span class="p">):</span>
    <span class="n">parallax</span> <span class="o">=</span> <span class="n">parallax</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

<span class="n">velocity_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;pm_ra_cosdec&quot;</span><span class="p">:</span> <span class="n">ngc188_table</span><span class="p">[</span><span class="s2">&quot;pmra&quot;</span><span class="p">],</span>
    <span class="s2">&quot;pm_dec&quot;</span><span class="p">:</span> <span class="n">ngc188_table</span><span class="p">[</span><span class="s2">&quot;pmdec&quot;</span><span class="p">],</span>
    <span class="s2">&quot;radial_velocity&quot;</span><span class="p">:</span> <span class="n">ngc188_table</span><span class="p">[</span><span class="s2">&quot;radial_velocity&quot;</span><span class="p">],</span>
<span class="p">}</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">velocity_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&quot;mask&quot;</span><span class="p">):</span>
        <span class="n">velocity_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">velocity_data</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">velocity_data</span><span class="p">[</span><span class="n">k</span><span class="p">])]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="n">ngc188_coords_3d</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span>
    <span class="n">ra</span><span class="o">=</span><span class="n">ngc188_table</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">],</span>
    <span class="n">dec</span><span class="o">=</span><span class="n">ngc188_table</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">],</span>
    <span class="n">distance</span><span class="o">=</span><span class="n">Distance</span><span class="p">(</span><span class="n">parallax</span><span class="o">=</span><span class="n">parallax</span><span class="p">),</span>
    <span class="n">obstime</span><span class="o">=</span><span class="n">Time</span><span class="p">(</span><span class="s2">&quot;J2015.5&quot;</span><span class="p">),</span>
    <span class="o">**</span><span class="n">velocity_data</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">sep3d</span> <span class="o">=</span> <span class="n">ngc188_coords_3d</span><span class="o">.</span><span class="n">separation_3d</span><span class="p">(</span><span class="n">ngc188_center_3d</span><span class="p">)</span>
<span class="n">pm_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
    <span class="p">(</span><span class="n">ngc188_table</span><span class="p">[</span><span class="s2">&quot;pmra&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ngc188_center_3d</span><span class="o">.</span><span class="n">pm_ra_cosdec</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="o">+</span> <span class="p">(</span><span class="n">ngc188_table</span><span class="p">[</span><span class="s2">&quot;pmdec&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ngc188_center_3d</span><span class="o">.</span><span class="n">pm_dec</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="p">)</span>

<span class="n">ngc188_members_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">sep3d</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">pm_diff</span> <span class="o">&lt;</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mas</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">)</span>
<span class="n">ngc188_members</span> <span class="o">=</span> <span class="n">ngc188_table</span><span class="p">[</span><span class="n">ngc188_members_mask</span><span class="p">]</span>
<span class="n">ngc188_members_coords</span> <span class="o">=</span> <span class="n">ngc188_coords_3d</span><span class="p">[</span><span class="n">ngc188_members_mask</span><span class="p">]</span>
<span class="nb">len</span><span class="p">(</span><span class="n">ngc188_members</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>265
</pre></div>
</div>
</div>
</div>
<p>From the selections above, the table <code class="docutils literal notranslate"><span class="pre">ngc188_members</span></code> and the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> instance <code class="docutils literal notranslate"><span class="pre">ngc188_members_coords</span></code> contain 216 sources that, based on their 3D positions and proper motions, are consistent with being members of the open cluster NGC 188.</p>
<p>Let’s assume that we now want to cross-match our catalog of candidate members of NGC 188 — here, based on <em>Gaia</em> data — to some other catalog. In this tutorial, we will demonstrate how to manually cross-match these <em>Gaia</em> sources with the 2MASS photometric catalog to retrieve infrared magnitudes for these stars, and then we will plot a color–magnitude diagram. To do this, we first need to query the 2MASS catalog to retrieve all sources in a region around the center of NGC 188, as we did for <em>Gaia</em>. Here, we will also take into account the fact that the <em>Gaia</em> data release 2 reference epoch is J2015.5, whereas the 2MASS coordinates are likely reported at their time of observation (in the late 1990’s).</p>
<p><em>Note that some data archives, like the Gaia science archive, support running cross-matches at the database level and even support epoch propagation. If you need to perform a large cross-match, it will be much more efficient to use these services!</em></p>
<p>We will again use <code class="docutils literal notranslate"><span class="pre">astroquery</span></code> to execute this query. This will again require an internet connection, but we have included the results of this query in a file along with this notebook in case you are not connected to the internet. To query 2MASS, we will use the <code class="docutils literal notranslate"><span class="pre">astroquery.vizier</span></code> module (<a class="reference external" href="https://astroquery.readthedocs.io/en/latest/vizier/vizier.html">docs</a>) to run a cone search centered on the sky position of NGC 188 with a search radius of 0.5º:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NOTE: skip this cell if you do not have an internet connection</span>

<span class="c1"># II/246 is the catalog name for the main 2MASS photometric catalog</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">Vizier</span><span class="p">(</span><span class="n">catalog</span><span class="o">=</span><span class="s2">&quot;II/246&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;Date&quot;</span><span class="p">])</span>
<span class="n">v</span><span class="o">.</span><span class="n">ROW_LIMIT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">query_region</span><span class="p">(</span><span class="n">ngc188_center_3d</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<span class="n">tmass_table</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Alternatively, we can read the 2MASS table provided along with this tutorial:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the .read() below produces some warnings that we can safely ignore</span>
<span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

    <span class="n">tmass_table</span> <span class="o">=</span> <span class="n">QTable</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;2MASS_results.ecsv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>As with the <em>Gaia</em> results table, we can now create a single <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> object to represent all of the sources returned from our query to the 2MASS catalog. Let’s look at the column names in this table by displaying the first few rows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmass_table</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>QTable length=3</i>
<table id="table140331604735520" class="table-striped table-bordered table-condensed">
<thead><tr><th>Date</th><th>RAJ2000</th><th>DEJ2000</th><th>_2MASS</th><th>Jmag</th><th>e_Jmag</th><th>Hmag</th><th>e_Hmag</th><th>Kmag</th><th>e_Kmag</th><th>Qflg</th><th>Rflg</th><th>Bflg</th><th>Cflg</th><th>Xflg</th><th>Aflg</th></tr></thead>
<thead><tr><th></th><th>deg</th><th>deg</th><th></th><th>mag</th><th>mag</th><th>mag</th><th>mag</th><th>mag</th><th>mag</th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead>
<thead><tr><th>str10</th><th>float64</th><th>float64</th><th>str16</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>str3</th><th>str3</th><th>str3</th><th>str3</th><th>uint8</th><th>uint8</th></tr></thead>
<tr><td>1999-10-19</td><td>9.633532</td><td>84.808350</td><td>00383204+8448300</td><td>13.079</td><td>0.030</td><td>12.742</td><td>0.033</td><td>12.729</td><td>0.035</td><td>AAA</td><td>222</td><td>111</td><td>000</td><td>0</td><td>0</td></tr>
<tr><td>1999-10-19</td><td>8.562472</td><td>84.873627</td><td>00341499+8452250</td><td>14.459</td><td>0.029</td><td>14.103</td><td>0.041</td><td>14.166</td><td>0.063</td><td>AAA</td><td>222</td><td>111</td><td>000</td><td>0</td><td>0</td></tr>
<tr><td>1999-10-19</td><td>8.645318</td><td>84.868584</td><td>00343487+8452069</td><td>10.356</td><td>0.026</td><td>10.057</td><td>0.032</td><td>10.000</td><td>0.020</td><td>AAA</td><td>222</td><td>111</td><td>000</td><td>0</td><td>0</td></tr>
</table></div></div></div>
</div>
<p>From looking at the column names, the two relevant sky coordinate columns are <code class="docutils literal notranslate"><span class="pre">RAJ2000</span></code> for <code class="docutils literal notranslate"><span class="pre">ra</span></code> and <code class="docutils literal notranslate"><span class="pre">DEJ2000</span></code> for <code class="docutils literal notranslate"><span class="pre">dec</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmass_coords</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">tmass_table</span><span class="p">[</span><span class="s2">&quot;RAJ2000&quot;</span><span class="p">],</span> <span class="n">tmass_table</span><span class="p">[</span><span class="s2">&quot;DEJ2000&quot;</span><span class="p">])</span>
<span class="nb">len</span><span class="p">(</span><span class="n">tmass_coords</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5014
</pre></div>
</div>
</div>
</div>
<p>Note also that the table contains a “Date” column that specifies the epoch of the coordinates. Are all of these epochs the same?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tmass_table</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">&lt;Column name=&apos;Date&apos; dtype=&apos;str10&apos; description=&apos;(date) Observation date&apos; length=1&gt;
<table>
<tr><td>1999-10-19</td></tr>
</table></div></div>
</div>
<p>It looks like all of the sources in our 2MASS table have the same epoch, so let’s create an <code class="docutils literal notranslate"><span class="pre">astropy.time.Time</span></code> object to represent this date:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmass_epoch</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tmass_table</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<p>We now want to cross-match our <em>Gaia</em>-selected candidate members of NGC 188, <code class="docutils literal notranslate"><span class="pre">ngc_members_coords</span></code>, with this table of photometry from 2MASS. However, as noted previously, the <em>Gaia</em> coordinates are given at a different epoch J2015.5, which is nearly ~16 years after the 2MASS epoch of the data we downloaded (1999-10-19 or roughly J1999.88). We will therefore first use the <code class="docutils literal notranslate"><span class="pre">SkyCoord.apply_space_motion()</span></code> method (<a class="reference external" href="http://docs.astropy.org/en/latest/api/astropy.coordinates.SkyCoord.html#astropy.coordinates.SkyCoord.apply_space_motion">docs</a>) to transform the <em>Gaia</em> positions back to the 2MASS epoch before we do the cross-match:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># you can ignore the warning raised here</span>
<span class="n">ngc188_members_coords_1999</span> <span class="o">=</span> <span class="n">ngc188_members_coords</span><span class="o">.</span><span class="n">apply_space_motion</span><span class="p">(</span><span class="n">tmass_epoch</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The object <code class="docutils literal notranslate"><span class="pre">ngc188_members_coords_1999</span></code> now contains the coordinate information for our <em>Gaia</em>-selected members of NGC 188, as we think they would appear if observed on 1999-10-19.</p>
<p>We can now use the <code class="docutils literal notranslate"><span class="pre">SkyCoord.match_to_catalog_sky</span></code> method to match these two catalogs (<a class="reference external" href="http://docs.astropy.org/en/latest/coordinates/matchsep.html#astropy-coordinates-matching">docs</a>), using the <code class="docutils literal notranslate"><span class="pre">ngc188_members_coords_1999</span></code> as our NGC 188 members coordinates.</p>
<p>Note that order matters with this method: Here we will match <em>Gaia</em> to 2MASS. <code class="docutils literal notranslate"><span class="pre">SkyCoord.match_to_catalog_sky</span></code> returns three objects: (1) the indices into <code class="docutils literal notranslate"><span class="pre">tmass_coords</span></code> that get the closest matches in <code class="docutils literal notranslate"><span class="pre">ngc188_members_coords_1999</span></code>, (2) the angular separation between each <code class="docutils literal notranslate"><span class="pre">ngc188_members_coords_1999</span></code> coordinate and the closest source in <code class="docutils literal notranslate"><span class="pre">tmass_coords</span></code>, and (3) the 3D distance between each <code class="docutils literal notranslate"><span class="pre">ngc188_members_coords_1999</span></code> coordinate and the closest source in <code class="docutils literal notranslate"><span class="pre">tmass_coords</span></code>. Here, the 3D distances will not be useful because the 2MASS coordinates do not have associated distance information, so we will ignore these quantities:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">idx_gaia</span><span class="p">,</span> <span class="n">sep2d_gaia</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ngc188_members_coords_1999</span><span class="o">.</span><span class="n">match_to_catalog_sky</span><span class="p">(</span><span class="n">tmass_coords</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s now look at the distribution of separations (in arcseconds) for all of the cross-matched sources:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sep2d_gaia</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mi">64</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;separation [arcsec]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/424ddcbb790c4eff564ffd8f16725ebbe2ce09e173e9249cb550c69728d37b9e.png" src="_images/424ddcbb790c4eff564ffd8f16725ebbe2ce09e173e9249cb550c69728d37b9e.png" />
</div>
</div>
<p>From this, it looks like all of sources in our <em>Gaia</em> NGC 188 member list cross-match to another sources within a few arcseconds, so these all seem like they are correctly matches to a 2MASS source!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">sep2d_gaia</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ngc188_members</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(np.int64(256), 265)
</pre></div>
</div>
</div>
</div>
<p>With our cross-match done, we can now make <code class="docutils literal notranslate"><span class="pre">Gaia</span></code>+2MASS color–magnitude diagrams of our candidate NGC 188 members using the information returned by the cross-match:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Jmag</span> <span class="o">=</span> <span class="n">tmass_table</span><span class="p">[</span><span class="s2">&quot;Jmag&quot;</span><span class="p">][</span><span class="n">idx_gaia</span><span class="p">]</span>  <span class="c1"># note that we use the index array returned above</span>
<span class="n">Gmag</span> <span class="o">=</span> <span class="n">ngc188_members</span><span class="p">[</span><span class="s2">&quot;phot_g_mean_mag&quot;</span><span class="p">]</span>
<span class="n">Bmag</span> <span class="o">=</span> <span class="n">ngc188_members</span><span class="p">[</span><span class="s2">&quot;phot_bp_mean_mag&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Gmag</span> <span class="o">-</span> <span class="n">Jmag</span><span class="p">,</span> <span class="n">Gmag</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$G - J$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$G$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># backwards because magnitudes!</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Bmag</span> <span class="o">-</span> <span class="n">Gmag</span><span class="p">,</span> <span class="n">Jmag</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$G_</span><span class="si">{BP}</span><span class="s2"> - G$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$J$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>  <span class="c1"># backwards because magnitudes!</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d7352de31abd9f5d96ec43b8cfc67e0fb609103c50703b4bb13d8e144e81b111.png" src="_images/d7352de31abd9f5d96ec43b8cfc67e0fb609103c50703b4bb13d8e144e81b111.png" />
</div>
</div>
<p>Those both look like color-magnitude diagrams of a main sequence + red giant branch of an intermediate-age stellar cluster, so it looks like our selection and cross-matching has worked!</p>
<p>For more on what matching options are available, check out the <a class="reference external" href="https://astropy.readthedocs.io/en/stable/coordinates/matchsep.html">separation and matching section of the Astropy documentation</a>. Or for more on what you can do with <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code>, see <a class="reference external" href="http://astropy.readthedocs.org/en/stable/api/astropy.coordinates.SkyCoord.html">its API documentation</a>.</p>
</section>
</section>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "astropy-learn/tutorial--astropy-coordinates",
            ref: "main/",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#document-1_Coordinates-Intro">Astronomical Coordinates 1: Getting Started with astropy.coordinates</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#document-2_Coordinates-Transforms">Astronomical Coordinates 2: Transforming Coordinate Systems and Representations</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#document-3_Coordinates-Velocities">Astronomical Coordinates 3: Working with Velocity Data in astropy.coordinates</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#document-4_Coordinates-Crossmatch">Astronomical Coordinates 4: Cross-matching Catalogs Using astropy.coordinates and astroquery</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By AUTHOR1 (@GITHUB-USERNAME, ORCID-ID), AUTHOR2 (@GITHUB-USERNAME, ORCID-ID)
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>